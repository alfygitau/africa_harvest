"use strict";(self.webpackChunkminia=self.webpackChunkminia||[]).push([[414],{4414:(K,y,l)=>{l.r(y),l.d(y,{ReportsModule:()=>Z});var p=l(177),_=l(8498),k=l(467),o=l(9417),v=l(3887),h=l(3165),f=l(3682),c=l(3380),g=l(2150),b=l(2654),C=l(3871),e=l(4438),w=l(5441),j=l(7148),I=l(9700),x=l(5794),F=l(8548);function E(n,u){if(1&n&&(e.j41(0,"option",82),e.EFF(1),e.k0s()),2&n){const r=u.$implicit;e.R7$(1),e.SpI(" ",r.name," ")}}function D(n,u){if(1&n&&(e.j41(0,"option",83),e.EFF(1),e.k0s()),2&n){const r=u.$implicit;e.R7$(1),e.SpI(" ",r.name," ")}}function T(n,u){if(1&n&&(e.j41(0,"option",84),e.EFF(1),e.k0s()),2&n){const r=u.$implicit;e.R7$(1),e.SpI(" ",r.name," ")}}function M(n,u){if(1&n){const r=e.RV6();e.j41(0,"div",43)(1,"h5",44),e.EFF(2,"Edit Farmer"),e.k0s(),e.j41(3,"button",45),e.bIt("click",function(){const s=e.eBV(r).$implicit;return e.Njj(s.dismiss("Cross click"))}),e.k0s()(),e.j41(4,"div",46)(5,"form",47),e.bIt("ngSubmit",function(t){e.eBV(r);const s=e.XpG(2);return e.Njj(s.handleSubmit(t))}),e.j41(6,"div",48)(7,"div",49)(8,"div",50)(9,"label",51),e.EFF(10,"First Name"),e.k0s(),e.nrm(11,"input",52),e.k0s(),e.j41(12,"div",50)(13,"label",53),e.EFF(14,"Last Name"),e.k0s(),e.nrm(15,"input",54),e.k0s(),e.j41(16,"div",50)(17,"label",55),e.EFF(18,"ID Number"),e.k0s(),e.nrm(19,"input",56),e.k0s(),e.j41(20,"div",50)(21,"label",57),e.EFF(22,"Date of Birth"),e.k0s(),e.nrm(23,"input",58),e.k0s()(),e.j41(24,"div",49)(25,"div",50)(26,"label",59),e.EFF(27,"Phone Number"),e.k0s(),e.nrm(28,"input",60),e.k0s(),e.j41(29,"div",50)(30,"label",61),e.EFF(31,"Gender"),e.k0s(),e.j41(32,"select",62)(33,"option",63),e.EFF(34,"Male"),e.k0s(),e.j41(35,"option",64),e.EFF(36,"Female"),e.k0s()()(),e.j41(37,"div",50)(38,"label",65),e.EFF(39,"Are you disbaled?"),e.k0s(),e.j41(40,"select",66)(41,"option",67),e.EFF(42,"TRUE"),e.k0s(),e.j41(43,"option",68),e.EFF(44,"FALSE"),e.k0s()()(),e.j41(45,"div",69)(46,"div",70)(47,"label",71),e.EFF(48,"County"),e.k0s(),e.j41(49,"select",72),e.DNE(50,E,2,1,"option",73),e.k0s()(),e.j41(51,"div",70)(52,"label",74),e.EFF(53,"Sub County"),e.k0s(),e.j41(54,"select",75),e.DNE(55,D,2,1,"option",76),e.k0s()(),e.j41(56,"div",70)(57,"label",77),e.EFF(58,"Ward"),e.k0s(),e.j41(59,"select",78),e.DNE(60,T,2,1,"option",79),e.k0s()()()()(),e.j41(61,"div",80)(62,"button",81),e.EFF(63," Update Farmer "),e.k0s()()()()}if(2&n){const r=e.XpG(2);e.R7$(5),e.Y8G("formGroup",r.updateFarmerForm),e.R7$(45),e.Y8G("ngForOf",r.counties),e.R7$(5),e.Y8G("ngForOf",r.sub_counties),e.R7$(5),e.Y8G("ngForOf",r.wards)}}function R(n,u){if(1&n){const r=e.RV6();e.j41(0,"div",30)(1,"div",23)(2,"input",31),e.bIt("change",function(t){const i=e.eBV(r).$implicit,d=e.XpG();return e.Njj(d.onRowSelect(t,i))}),e.k0s()(),e.j41(3,"div",32),e.EFF(4),e.k0s(),e.j41(5,"div",33),e.EFF(6),e.k0s(),e.j41(7,"div",33),e.EFF(8),e.k0s(),e.j41(9,"div",33),e.EFF(10),e.k0s(),e.j41(11,"div",34),e.EFF(12),e.k0s(),e.j41(13,"div",34),e.EFF(14),e.k0s(),e.j41(15,"div",34),e.EFF(16),e.k0s(),e.j41(17,"div",34),e.EFF(18),e.k0s(),e.j41(19,"div",34),e.EFF(20),e.k0s(),e.j41(21,"div",35),e.qSk(),e.j41(22,"svg",36),e.bIt("click",function(){const s=e.eBV(r).$implicit,i=e.XpG();return e.Njj(i.view(s))}),e.j41(23,"g",37),e.nrm(24,"circle",38)(25,"path",39),e.k0s()(),e.j41(26,"svg",40),e.bIt("click",function(){const s=e.eBV(r).$implicit,i=e.sdS(30),d=e.XpG();return e.Njj(d.centerModal(i,s))}),e.nrm(27,"path",41),e.k0s(),e.joV(),e.j41(28,"div"),e.DNE(29,M,64,4,"ng-template",null,42,e.C5r),e.k0s()()()}if(2&n){const r=u.$implicit,a=e.XpG();e.R7$(2),e.Y8G("checked",a.isSelected(null==r?null:r.member_id)),e.R7$(2),e.SpI(" ",r.member_id," "),e.R7$(2),e.Lme(" ",r.first_name," ",r.last_name," "),e.R7$(2),e.SpI(" ",r.msisdn," "),e.R7$(2),e.SpI(" ",r.id_number," "),e.R7$(2),e.SpI(" ",r.gender," "),e.R7$(2),e.SpI(" ","True"===r.is_disabled?"YES":"NO"," "),e.R7$(2),e.SpI(" ",r.county_title," "),e.R7$(2),e.SpI(" ",r.sub_county_title," "),e.R7$(2),e.SpI(" ",r.ward_name," ")}}let G=(()=>{class n{constructor(r,a,t,s,i,d,m){this.formBuilder=r,this.cdr=a,this.groupsService=t,this.farmersService=s,this.usersService=i,this.modalService=d,this.toastr=m,this.ColumnMode=c.oZ,this.counties=[],this.sub_counties=[],this.wards=[],this.groups=[],this.rows=[],this.filteredArray=[],this.currentPage=1,this.selectedRows=new Set,this.updateCounties=[],this.updateSubcounties=[],this.updateWards=[],this.totalCounts=1,this.dataParams={page_num:1,page_size:10},this.selectedCounty=[],this.myCounties=[],this.subcountyOptions=[{subCountyId:1,name:"Select a subcounty"}],this.wardOptions=[{wardId:1,name:"Select a ward"}],this.myGroups=[{subCountyId:1,name:"Select a group"}],this.selectedSubcounty=[],this.selectedWard=[],this.selectedGroup=[]}formatDate(r){let a=new Date(r),t=""+(a.getMonth()+1),s=""+a.getDate(),i=a.getFullYear();return t.length<2&&(t="0"+t),s.length<2&&(s="0"+s),[i,t,s].join("-")}ngOnInit(){const r=new Date,a=new Date;a.setMonth(a.getMonth()-5),this.dataParams.page_num=1,this.dataParams.page_size=10,this.counties=h.v,this.myCounties=this.transformCounties(h.v),this.breadCrumbItems=[{label:"Reports"},{label:"Farmers",active:!0}],this.searchForm=this.formBuilder.group({start_date:[this.formatDate(a),o.k0.required],end_date:[this.formatDate(r),o.k0.required],countyId:[[],o.k0.required],subCountyId:[[],o.k0.required],wardId:[[],o.k0.required],groupId:[[],o.k0.required]}),this.updateFarmerForm=this.formBuilder.group({dob:[this.formatDate(new Date),o.k0.required],gender:["",o.k0.required],disabled:["",o.k0.required],is_tot:null,msisdn:["",o.k0.required],id_number:["",o.k0.required],last_name:["",o.k0.required],ward_name:["",o.k0.required],first_name:["",o.k0.required],county_title:["",o.k0.required],sub_county_title:["",o.k0.required]});let t={page:this.dataParams.page_num,dataObj:{countyId:this.searchForm.get("countyId")?.value.map(s=>s.county_id),subCountyId:this.searchForm.get("subCountyId")?.value.map(s=>s.subCountyId),wardId:this.searchForm.get("wardId")?.value.map(s=>s.wardId),groupId:this.searchForm.get("groupId")?.value.map(s=>s.group_id),startDate:this.searchForm.get("startDate")?.value?this.searchForm.get("startDate")?.value:"",endDate:this.searchForm.get("endDate")?.value?this.searchForm.get("endDate")?.value:""},size:this.dataParams.page_size};this.getUsers(t),this.searchForm.valueChanges.subscribe(()=>{let s={countyId:this.searchForm.get("countyId")?.value.map(d=>d.county_id),subCountyId:this.searchForm.get("subCountyId")?.value.map(d=>d.subCountyId),wardId:this.searchForm.get("wardId")?.value.map(d=>d.wardId),groupId:this.searchForm.get("groupId")?.value.map(d=>d.group_id),startDate:this.searchForm.get("start_date")?.value?this.searchForm.get("start_date")?.value:"",endDate:this.searchForm.get("end_date")?.value?this.searchForm.get("end_date")?.value:""},i={page:this.dataParams.page_num,dataObj:s,size:this.dataParams.page_size};this.filterGroups(s),this.getUsers(i)})}filter(r){const a=r?.map(t=>t.county_id);if(a){const t=this.counties.filter(s=>a.includes(s.county_id)).flatMap(s=>s.sub_counties);console.log(t),this.subcountyOptions=[{subCountyId:1,name:"Select a subcounty"},...t],this.wardOptions=[{wardId:1,name:"Select a ward"}]}}filterWards(r){this.wardOptions=[{wardId:1,name:"Select a ward"}],r.forEach(a=>{a&&a.wards&&this.wardOptions.push(...a.wards)})}transformCounties(r){return r.map(a=>({label:a.name,value:a.county_id}))}subCounties(r){if(this.searchForm){let a=this.searchForm.get("countyId")?.value;this.counties.filter(s=>a.includes(s.county_id)).forEach(s=>{this.sub_counties=this.sub_counties.concat(s.sub_counties)})}this.onSubmit()}centerModal(r,a){this.selectedFarmer=a,void 0!==this.selectedFarmer.county_id&&(this.sub_counties=this.fetchSubcounties(this.selectedFarmer.county_id)),void 0!==this.selectedFarmer.sub_county_id&&(this.wards=this.fetchWards(this.selectedFarmer.sub_county_id)),this.updateFarmerForm.patchValue({dob:this.formatDate(new Date(this.selectedFarmer.dob)),gender:this.selectedFarmer.gender,disabled:this.selectedFarmer.is_disabled,is_tot:null,msisdn:this.selectedFarmer.msisdn,id_number:this.selectedFarmer.id_number,last_name:this.selectedFarmer.last_name,ward_name:this.selectedFarmer.ward_name,first_name:this.selectedFarmer.first_name,county_title:this.selectedFarmer.county_title,sub_county_title:this.selectedFarmer.sub_county_title}),this.modalService.open(r,{centered:!0,windowClass:"modal-user-holder",size:"lg"})}handleSubmit(r){var a=this;return(0,k.A)(function*(){if(r.preventDefault(),a.updateFarmerForm.valid){const t={firstName:a.updateFarmerForm.value.first_name,lastName:a.updateFarmerForm.value.last_name,gender:a.updateFarmerForm.value.gender,idNumber:a.updateFarmerForm.value.id_number,dob:a.updateFarmerForm.value.dob,msisdn:a.updateFarmerForm.value.msisdn,memberId:a.selectedFarmer.member_id,groupId:a.selectedFarmer.group_id,wardId:a.selectedFarmer.ward_id};yield a.usersService.updateMember(a.selectedFarmer?.member_id,t).subscribe(s=>{a.toastr.success("Success","User updated successfully");let i={page:a.dataParams.page_num,dataObj:{countyId:a.searchForm.get("countyId")?.value.map(d=>d.county_id),subCountyId:a.searchForm.get("subCountyId")?.value.map(d=>d.subCountyId),wardId:a.searchForm.get("wardId")?.value.map(d=>d.wardId),groupId:a.searchForm.get("groupId")?.value.map(d=>d.group_id),startDate:a.searchForm.get("startDate")?.value?a.searchForm.get("startDate")?.value:"",endDate:a.searchForm.get("endDate")?.value?a.searchForm.get("endDate")?.value:""},size:a.dataParams.page_size};a.getUsers(i),a.modalService.dismissAll()},s=>{console.error("Error:",s),a.toastr.error("Error","Failed to update user")})}})()}onSubmit(){let r=this.searchForm.value;r.wardId.length>0&&(r.subCountyId=[],r.countyId=[]),r.subCountyId.length>0&&(r.wardId=[],r.countyId=[]),this.farmersService.getMembersByLocations(r).subscribe(a=>{200==a.statusCode&&(this.rows=a.message.members,this.totalCounts=a.message.counts,this.cdr.markForCheck())})}getWards(r){if(this.searchForm){let a=this.searchForm.get("subCountyId")?.value;this.sub_counties.filter(s=>a.includes(s.subCountyId)).forEach(s=>{this.wards=this.wards.concat(s.wards)})}this.onSubmit()}filterGroups(r){this.searchForm&&this.groupsService.getGroupsByLocation(r).subscribe(a=>{200==a.statusCode&&(this.groups=a.message,this.cdr.markForCheck(),this.myGroups=[{group_id:1,name:"Select a group"},...a.message.map(t=>({group_id:t.group_id,name:t.group_name,ward_id:t.ward_id,description:t.description,group_admin_name:t.group_admin.name}))])})}view(r){}getUsers(r){this.farmersService.getClients(r).subscribe(a=>{200==a.statusCode&&(this.rows=a.message.members,this.totalCounts=a.message.counts,this.cdr.markForCheck())})}exportSelectedMembers(){let r={memberId:Array.from(this.selectedRows)};this.farmersService.exportMembers(r).subscribe(a=>{const t=document.createElement("a"),s=URL.createObjectURL(a);t.href=s,t.download="members.xlsx",t.click(),URL.revokeObjectURL(s),this.cdr.markForCheck(),this.cdr.markForCheck()})}exportEntireMembersReport(){let a={page:1,dataObj:{countyId:this.searchForm.get("countyId")?.value.map(t=>t.county_id),subCountyId:this.searchForm.get("subCountyId")?.value.map(t=>t.subCountyId),wardId:this.searchForm.get("wardId")?.value.map(t=>t.wardId),groupId:this.searchForm.get("groupId")?.value.map(t=>t.group_id),startDate:this.searchForm.get("start_date")?.value?this.searchForm.get("start_date")?.value:"",endDate:this.searchForm.get("end_date")?.value?this.searchForm.get("end_date")?.value:""},size:1e5};this.farmersService.exportAllMembers(a).subscribe(t=>{const s=document.createElement("a"),i=URL.createObjectURL(t);s.href=i,s.download="members.xlsx",s.click(),URL.revokeObjectURL(i),this.cdr.markForCheck(),this.cdr.markForCheck()})}getCounties(){this.updateCounties=this.usersService.fetchCounties()}setPage(r){this.dataParams.page_num=r;let a={page:this.dataParams.page_num,dataObj:{countyId:this.searchForm.get("countyId")?.value.map(t=>t.county_id),subCountyId:this.searchForm.get("subCountyId")?.value.map(t=>t.subCountyId),wardId:this.searchForm.get("wardId")?.value.map(t=>t.wardId),groupId:this.searchForm.get("groupId")?.value.map(t=>t.group_id),startDate:this.searchForm.get("start_date")?.value?this.searchForm.get("start_date")?.value:"",endDate:this.searchForm.get("end_date")?.value?this.searchForm.get("end_date")?.value:""},size:this.dataParams.page_size};this.farmersService.getClients(a).subscribe(t=>{200==t.statusCode&&(this.rows=t.message.members,this.totalCounts=t.message.counts,this.cdr.markForCheck())})}fetchSubcounties(r){return this.usersService.fetchSubCounties(r)}fetchWards(r){return this.usersService.getWards(r)}selectAll(r){r.target.checked?this.rows.forEach(t=>this.selectedRows.add(t.member_id)):this.selectedRows.clear()}onRowSelect(r,a){r.target.checked?this.selectedRows.add(a.member_id):this.selectedRows.delete(a.member_id)}isSelected(r){return this.selectedRows?.has(r)}static#e=this.\u0275fac=function(a){return new(a||n)(e.rXU(o.ok),e.rXU(e.gRc),e.rXU(w.U),e.rXU(j.s),e.rXU(I.g),e.rXU(g.Bq),e.rXU(x.tw))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-farmers"]],standalone:!0,features:[e.aNF],decls:73,vars:18,consts:[["title","Reports",3,"breadcrumbItems"],[1,"card"],[1,"card-body"],[1,"col-lg-12","d-flex","w-100",3,"formGroup"],[1,"d-flex","flex-sm-column","flex-md-column","flex-lg-row","flex-wrap","justify-content-between","w-100"],[1,"d-flex","flex-column"],["for","example-datetime-local-input",1,"form-label"],["type","date","placeholder","Start","formControlName","start_date","id","example-datetime-local-input",1,"form-control",2,"width","180px !important"],["type","date","placeholder","End","formControlName","end_date","id","example-datetime-local-input",1,"form-control",2,"width","180px !important"],["for","county"],["formControlName","countyId","optionLabel","name","placeholder","Select county",1,"fixed-width-multiselect",3,"options","ngModel","ngModelChange","onChange"],["formControlName","subCountyId","optionLabel","name","placeholder","Select a subcounty",3,"options","ngModel","ngModelChange","onChange"],["formControlName","wardId","optionLabel","name","placeholder","Select a ward",3,"options","ngModel","ngModelChange"],["formControlName","groupId","optionLabel","name","placeholder","Select a group",3,"options","ngModel","ngModelChange"],[2,"margin-top","20px","width","100%","padding-left","0px","display","flex","align-items","center","justify-content","end","gap","20px"],[1,"d-flex","flex-row","align-items-center","gap-2",2,"cursor","pointer",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","viewBox","0 0 24 24"],["fill","#3fc057","d","M15.707 13.293a1 1 0 0 0-1.414 0L13 14.586V3a1 1 0 0 0-2 0v11.586l-1.293-1.293a1 1 0 0 0-1.414 1.414l3 3a1 1 0 0 0 1.414 0l3-3a1 1 0 0 0 0-1.414"],["fill","#3fc057","d","M18 9h-5v5.586l1.293-1.293a1 1 0 0 1 1.414 1.414l-3 3a1 1 0 0 1-1.414 0l-3-3a1 1 0 0 1 1.414-1.414L11 14.586V9H6a3.003 3.003 0 0 0-3 3v7a3.003 3.003 0 0 0 3 3h12a3.003 3.003 0 0 0 3-3v-7a3.003 3.003 0 0 0-3-3","opacity","0.5"],[1,"d-flex","align-items-center","flex-row","gap-2",2,"cursor","pointer",3,"click"],[2,"background-color","white","padding-left","10px","padding-right","10px","padding-top","10px","padding-bottom","10px"],[2,"width","100%"],[1,"d-flex","align-items-center",2,"width","100%","height","40px","border-bottom","1px solid #e9e9ef","font-weight","bold"],[2,"width","5%"],["type","checkbox","id","select_all",3,"change"],[1,"text-truncate",2,"height","100%","font-size","15px","width","5%"],[1,"text-truncate",2,"height","100%","font-size","15px","width","10%"],["class","d-flex flex-row align-items-center","style","height: 48px; border-bottom: 1px solid #e9e9ef",4,"ngFor","ngForOf"],[2,"display","flex","align-items","center","justify-content","space-between","width","100%","height","80px","margin-top","20px"],[3,"collectionSize","page","maxSize","boundaryLinks","pageChange"],[1,"d-flex","flex-row","align-items-center",2,"height","48px","border-bottom","1px solid #e9e9ef"],["type","checkbox",3,"checked","change"],[1,"text-truncate",2,"height","100%","font-size","12px","width","5%","display","flex","align-items","center"],[1,"text-truncate",2,"height","100%","font-size","12px","width","10%","display","flex","align-items","center"],[1,"text-truncate",2,"height","100%","width","10%","font-size","12px","display","flex","align-items","center"],[2,"height","100%","width","10%","display","flex","align-items","center"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24",2,"cursor","pointer","margin-right","10px",3,"click"],["fill","none","stroke","#000"],["cx","12","cy","12","r","3.5"],["d","M20.188 10.934c.388.472.582.707.582 1.066c0 .359-.194.594-.582 1.066C18.768 14.79 15.636 18 12 18c-3.636 0-6.768-3.21-8.188-4.934c-.388-.472-.582-.707-.582-1.066c0-.359.194-.594.582-1.066C5.232 9.21 8.364 6 12 6c3.636 0 6.768 3.21 8.188 4.934Z"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24",2,"cursor","pointer",3,"click"],["fill","none","stroke","#000","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","m14.304 4.844l2.852 2.852M7 7H4a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h11a1 1 0 0 0 1-1v-4.5m2.409-9.91a2.017 2.017 0 0 1 0 2.853l-6.844 6.844L8 14l.713-3.565l6.844-6.844a2.015 2.015 0 0 1 2.852 0Z"],["userModal",""],[1,"modal-header"],[1,"modal-title","mt-0"],["type","button","aria-hidden","true",1,"btn-close",3,"click"],[1,"modal-body"],[2,"width","100%",3,"formGroup","ngSubmit"],[2,"width","100%","display","flex","gap","20px"],[1,"d-flex","flex-column",2,"width","50%"],[1,"d-flex","flex-column",2,"margin-bottom","10px"],["for","firstname",2,"margin-bottom","0px"],["type","text","formControlName","first_name","id","firstname","placeholder","Enter First Name",2,"height","50px","width","100%","padding-left","10px","padding-right","10px","border","1px solid #e9e9ef","border-radius","5px"],["for","lastname",2,"margin-bottom","0px"],["type","text","formControlName","last_name","id","lastname","placeholder","Enter Last Name",2,"height","50px","width","100%","padding-left","10px","padding-right","10px","border","1px solid #e9e9ef","border-radius","5px"],["for","idnumber",2,"margin-bottom","0px"],["type","text","formControlName","id_number","id","idnumber","placeholder","Enter Id Number",2,"height","50px","width","100%","padding-left","10px","padding-right","10px","border","1px solid #e9e9ef","border-radius","5px"],["for","dateOfBirth",2,"margin-bottom","0px"],["type","date","formControlName","dob","id","dateOfBirth","placeholder","Enter date of birth",2,"height","50px","width","100%","padding-left","10px","padding-right","10px","border","1px solid #e9e9ef","border-radius","5px"],["for","phonenumber",2,"margin-bottom","0px"],["type","text","formControlName","msisdn","id","phonenumber","placeholder","Enter phone number",2,"height","50px","width","100%","padding-left","10px","padding-right","10px","border","1px solid #e9e9ef","border-radius","5px"],["for","gender",2,"margin-bottom","0px"],["formControlName","gender","id","gender","placeholder","Select gender","aria-label","Default select example",1,"form-select",2,"height","50px !important"],["value","MALE"],["value","FEMALE"],["for","disabled",2,"margin-bottom","0px"],["formControlName","disabled","id","disabled","placeholder","Select disability status","aria-label","Default select example",1,"form-select",2,"height","50px !important"],["value","TRUE"],["value","FALSE"],[2,"width","100%","display","flex","align-items","center","justify-content","space-between"],[1,"d-flex","flex-column",2,"margin-bottom","10px","width","30%"],["for","county",2,"margin-bottom","0px"],["formControlName","county_title","id","county","placeholder","Select county","aria-label","Default select example",1,"form-select",2,"height","50px !important"],["value","county?.name",4,"ngFor","ngForOf"],["for","subcounty",2,"margin-bottom","0px"],["formControlName","sub_county_title","id","subcounty","placeholder","Select subcounty","aria-label","Default select example",1,"form-select",2,"height","50px !important"],["value","subcounty?.name",4,"ngFor","ngForOf"],["for","ward",2,"margin-bottom","0px"],["formControlName","ward_name","id","ward","placeholder","Select ward","aria-label","Default select example",1,"form-select",2,"height","50px !important"],["value","ward?.name",4,"ngFor","ngForOf"],[2,"width","100%","margin-top","10px","margin-bottom","10px","display","flex","justify-content","end"],["type","submit",2,"height","50px","background-color","#1f6e50","border","none","border-radius","5px","color","white","width","20%"],["value","county?.name"],["value","subcounty?.name"],["value","ward?.name"]],template:function(a,t){1&a&&(e.nrm(0,"app-pagetitle",0),e.j41(1,"div")(2,"div",1)(3,"div",2)(4,"form",3)(5,"div",4)(6,"div",5)(7,"label",6),e.EFF(8,"Start Date"),e.k0s(),e.nrm(9,"input",7),e.k0s(),e.j41(10,"div",5)(11,"label",6),e.EFF(12,"End Date"),e.k0s(),e.nrm(13,"input",8),e.k0s(),e.j41(14,"div",5)(15,"label",9),e.EFF(16,"County"),e.k0s(),e.j41(17,"p-multiSelect",10),e.bIt("ngModelChange",function(i){return t.selectedCounty=i})("onChange",function(i){return t.filter(i.value)}),e.k0s()(),e.j41(18,"div",5)(19,"label",9),e.EFF(20,"Sub County"),e.k0s(),e.j41(21,"p-multiSelect",11),e.bIt("ngModelChange",function(i){return t.selectedSubcounty=i})("onChange",function(i){return t.filterWards(i.value)}),e.k0s()(),e.j41(22,"div",5)(23,"label",9),e.EFF(24,"Ward"),e.k0s(),e.j41(25,"p-multiSelect",12),e.bIt("ngModelChange",function(i){return t.selectedWard=i}),e.k0s()(),e.j41(26,"div",5)(27,"label",9),e.EFF(28,"Group"),e.k0s(),e.j41(29,"p-multiSelect",13),e.bIt("ngModelChange",function(i){return t.selectedGroup=i}),e.k0s()()()(),e.j41(30,"div",14)(31,"p",15),e.bIt("click",function(){return t.exportSelectedMembers()}),e.qSk(),e.j41(32,"svg",16),e.nrm(33,"path",17)(34,"path",18),e.k0s(),e.EFF(35," Export Selected Members "),e.k0s(),e.joV(),e.j41(36,"p",19),e.bIt("click",function(){return t.exportEntireMembersReport()}),e.qSk(),e.j41(37,"svg",16),e.nrm(38,"path",17)(39,"path",18),e.k0s(),e.EFF(40," Export All Members "),e.k0s()()()(),e.joV(),e.j41(41,"div",20)(42,"div",21)(43,"div",22)(44,"div",23)(45,"input",24),e.bIt("change",function(i){return t.selectAll(i)}),e.k0s()(),e.j41(46,"div",25),e.EFF(47," Member Id "),e.k0s(),e.j41(48,"div",26),e.EFF(49," Name "),e.k0s(),e.j41(50,"div",26),e.EFF(51," Mobile "),e.k0s(),e.j41(52,"div",26),e.EFF(53," ID Number "),e.k0s(),e.j41(54,"div",26),e.EFF(55," Gender "),e.k0s(),e.j41(56,"div",26),e.EFF(57," Disability Status "),e.k0s(),e.j41(58,"div",26),e.EFF(59," County "),e.k0s(),e.j41(60,"div",26),e.EFF(61," Sub County "),e.k0s(),e.j41(62,"div",26),e.EFF(63," Ward "),e.k0s(),e.j41(64,"div",26),e.EFF(65," Details "),e.k0s()(),e.j41(66,"div"),e.DNE(67,R,31,11,"div",27),e.j41(68,"div",28)(69,"p"),e.EFF(70),e.k0s(),e.j41(71,"div")(72,"ngb-pagination",29),e.bIt("pageChange",function(i){return t.setPage(i)})("pageChange",function(i){return t.dataParams.page_num=i}),e.k0s()()()()()()()),2&a&&(e.Y8G("breadcrumbItems",t.breadCrumbItems),e.R7$(4),e.Y8G("formGroup",t.searchForm),e.R7$(13),e.Y8G("options",t.counties)("ngModel",t.selectedCounty),e.R7$(4),e.Y8G("options",t.subcountyOptions)("ngModel",t.selectedSubcounty),e.R7$(4),e.Y8G("options",t.wardOptions)("ngModel",t.selectedWard),e.R7$(4),e.Y8G("options",t.myGroups)("ngModel",t.selectedGroup),e.R7$(38),e.Y8G("ngForOf",t.rows),e.R7$(3),e.E5c(" Showing ",1===t.dataParams.page_size?1:t.dataParams.page_num*t.dataParams.page_size-10," to ",t.dataParams.page_num*t.dataParams.page_size," of ",200," entries "),e.R7$(2),e.Y8G("collectionSize",t.totalCounts)("page",t.dataParams.page_num)("maxSize",5)("boundaryLinks",!0))},dependencies:[v.G,F.T,o.X1,o.qT,o.xH,o.y7,o.me,o.wz,o.BC,o.cb,o.j4,o.JD,f.MQ,c.Kj,o.YN,p.MD,p.Sq,g.XZ,g.c9,g.s5,b.iV,b.KF,C.D],styles:[".responsive-table[_ngcontent-%COMP%]{width:100%!important;max-width:100%!important;overflow-x:auto!important}.truncate[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}"]})}return n})();var N=l(8404);function $(n,u){if(1&n){const r=e.RV6();e.j41(0,"div",22)(1,"div",23),e.EFF(2),e.nI1(3,"date"),e.k0s(),e.j41(4,"div",24),e.EFF(5),e.k0s(),e.j41(6,"div",24),e.EFF(7),e.k0s(),e.j41(8,"div",23),e.EFF(9),e.k0s(),e.j41(10,"div",23),e.EFF(11),e.k0s(),e.j41(12,"div",23),e.EFF(13),e.k0s(),e.j41(14,"div",25),e.qSk(),e.j41(15,"svg",26),e.bIt("click",function(){const s=e.eBV(r).$implicit,i=e.XpG();return e.Njj(i.view(s))}),e.j41(16,"g",27),e.nrm(17,"circle",28)(18,"path",29),e.k0s()(),e.j41(19,"svg",30),e.nrm(20,"path",31),e.k0s()()()}if(2&n){const r=u.$implicit;e.R7$(2),e.SpI(" ",e.bMT(3,6,r.created_at)," "),e.R7$(3),e.SpI(" ",r.course.title," "),e.R7$(2),e.SpI(" ",r.course_module.title," "),e.R7$(2),e.SpI(" ",r.trainer.name," "),e.R7$(2),e.SpI(" ",r.value_chain.value_chain_name," "),e.R7$(2),e.SpI(" ",r.training_date," ")}}let P=(()=>{class n{formatDate(r){let a=new Date(r),t=""+(a.getMonth()+1),s=""+a.getDate(),i=a.getFullYear();return t.length<2&&(t="0"+t),s.length<2&&(s="0"+s),[i,t,s].join("-")}constructor(r,a,t,s){this.groupsService=r,this.cdr=a,this.formBuilder=t,this.coursesSerice=s,this.counties=[],this.sub_counties=[],this.wards=[],this.ColumnMode=c.oZ,this.trainings=[],this.dataParams={page_num:"",page_size:""},this.groups=[],this.selectedCounty=[],this.myCounties=[],this.subcountyOptions=[{subCountyId:1,name:"Select a subcounty"}],this.wardOptions=[{wardId:1,name:"Select a ward"}],this.myGroups=[{subCountyId:1,name:"Select a group"}],this.selectedSubcounty=[],this.selectedWard=[],this.selectedGroup=[]}ngOnInit(){this.breadCrumbItems=[{label:"Reports"},{label:"Trainings",active:!0}],this.dataParams.page_num=1,this.dataParams.page_size=10,this.counties=h.v,this.myCounties=this.transformCounties(h.v);const r=new Date,a=new Date;a.setMonth(a.getMonth()-5),this.searchForm=this.formBuilder.group({start_date:[this.formatDate(a),o.k0.required],end_date:[this.formatDate(r),o.k0.required],countyId:[[],o.k0.required],subCountyId:[[],o.k0.required],wardId:[[],o.k0.required],groupId:[[],o.k0.required]}),this.searchForm.valueChanges.subscribe(()=>{let t={countyId:this.searchForm.get("countyId")?.value.map(i=>i.county_id),subCountyId:this.searchForm.get("subCountyId")?.value.map(i=>i.subCountyId),wardId:this.searchForm.get("wardId")?.value.map(i=>i.wardId),groupId:this.searchForm.get("groupId")?.value.map(i=>i.group_id),startDate:this.searchForm.get("start_date")?.value?this.searchForm.get("start_date")?.value:"",endDate:this.searchForm.get("end_date")?.value?this.searchForm.get("end_date")?.value:""};this.filterGroups(t),this.getTrainingWithFilters(t)}),this.getTrainings()}filter(r){const a=r?.map(t=>t.county_id);if(a){const t=this.counties.filter(s=>a.includes(s.county_id)).flatMap(s=>s.sub_counties);console.log(t),this.subcountyOptions=[{subCountyId:1,name:"Select a subcounty"},...t],this.wardOptions=[{wardId:1,name:"Select a ward"}]}}filterWards(r){this.wardOptions=[{wardId:1,name:"Select a ward"}],r.forEach(a=>{a&&a.wards&&this.wardOptions.push(...a.wards)})}transformCounties(r){return r.map(a=>({label:a.name,value:a.county_id}))}onSubmit(){let r=this.searchForm.value;r.wardId.length>0&&(r.subCountyId=[],r.countyId=[]),r.subCountyId.length>0&&(r.wardId=[],r.countyId=[])}getTrainings(){this.coursesSerice.getTrainings(this.dataParams.page_num).subscribe(r=>{200==r.statusCode&&(this.trainings=r.message.trainings,this.cdr.markForCheck())})}view(r){}getTrainingWithFilters(r){this.coursesSerice.getTrainingReportByLocation(r).subscribe(a=>{200==a.statusCode&&(this.trainings=a.message.trainings,this.cdr.markForCheck())})}setPage(r){this.dataParams.page_num=r,this.coursesSerice.getTrainings(this.dataParams.page_num).subscribe(t=>{this.trainings=t.message.trainings})}subCounties(r){if(this.searchForm){let a=this.searchForm.get("countyId")?.value;this.counties.filter(s=>a.includes(s.county_id)).forEach(s=>{this.sub_counties=this.sub_counties.concat(s.sub_counties)})}}getWards(r){if(this.searchForm){let a=this.searchForm.get("subCountyId")?.value;this.sub_counties.filter(s=>a.includes(s.subCountyId)).forEach(s=>{this.wards=this.wards.concat(s.wards)})}}filterGroups(r){this.searchForm&&this.groupsService.getGroupsByLocation(r).subscribe(a=>{200==a.statusCode&&(this.groups=a.message,this.cdr.markForCheck())})}static#e=this.\u0275fac=function(a){return new(a||n)(e.rXU(w.U),e.rXU(e.gRc),e.rXU(o.ok),e.rXU(N._))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-trainings"]],standalone:!0,features:[e.aNF],decls:52,vars:19,consts:[["title","Trainings Reports",3,"breadcrumbItems"],[1,"card"],[1,"card-body"],[1,"col-lg-12","d-flex","w-100",3,"formGroup"],[1,"d-flex","flex-sm-column","flex-md-column","flex-lg-row","flex-wrap","justify-content-between","w-100"],[1,"d-flex","flex-column"],["for","example-datetime-local-input",1,"form-label"],["type","date","placeholder","Start","formControlName","start_date","id","example-datetime-local-input",1,"form-control",2,"width","180px !important"],["type","date","placeholder","End","formControlName","end_date","id","example-datetime-local-input",1,"form-control",2,"width","180px !important"],["for","county"],["formControlName","countyId","optionLabel","name","placeholder","Select county",1,"fixed-width-multiselect",3,"options","ngModel","ngModelChange","onChange"],["formControlName","subCountyId","optionLabel","name","placeholder","Select a subcounty",3,"options","ngModel","ngModelChange","onChange"],["formControlName","wardId","optionLabel","name","placeholder","Select a ward",3,"options","ngModel","ngModelChange"],["formControlName","groupId","optionLabel","name","placeholder","Select a group",3,"options","ngModel","ngModelChange"],[2,"background-color","white","padding-left","10px","padding-right","10px","padding-top","10px","padding-bottom","10px","margin-bottom","10px"],[1,"d-flex","align-items-center",2,"width","100%","height","50px","border-bottom","1px solid #e9e9ef","font-weight","bold"],[2,"width","15%"],[2,"width","20%"],[2,"width","10%"],["class","d-flex flex-row align-items-center","style","height: 50px; border-bottom: 1px solid #e9e9ef",4,"ngFor","ngForOf"],[2,"display","flex","align-items","center","justify-content","space-between","width","100%","height","80px","margin-top","20px"],[3,"collectionSize","page","maxSize","boundaryLinks","pageChange"],[1,"d-flex","flex-row","align-items-center",2,"height","50px","border-bottom","1px solid #e9e9ef"],[1,"text-truncate",2,"width","15%","font-size","12px"],[1,"text-truncate",2,"width","20%","font-size","12px"],[2,"width","10%","font-size","12px"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24",2,"cursor","pointer","margin-right","10px",3,"click"],["fill","none","stroke","#000"],["cx","12","cy","12","r","3.5"],["d","M20.188 10.934c.388.472.582.707.582 1.066c0 .359-.194.594-.582 1.066C18.768 14.79 15.636 18 12 18c-3.636 0-6.768-3.21-8.188-4.934c-.388-.472-.582-.707-.582-1.066c0-.359.194-.594.582-1.066C5.232 9.21 8.364 6 12 6c3.636 0 6.768 3.21 8.188 4.934Z"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24",2,"cursor","pointer"],["fill","none","stroke","#000","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","m14.304 4.844l2.852 2.852M7 7H4a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h11a1 1 0 0 0 1-1v-4.5m2.409-9.91a2.017 2.017 0 0 1 0 2.853l-6.844 6.844L8 14l.713-3.565l6.844-6.844a2.015 2.015 0 0 1 2.852 0Z"]],template:function(a,t){1&a&&(e.nrm(0,"app-pagetitle",0),e.j41(1,"div")(2,"div",1)(3,"div",2)(4,"form",3)(5,"div",4)(6,"div",5)(7,"label",6),e.EFF(8,"Start Date"),e.k0s(),e.nrm(9,"input",7),e.k0s(),e.j41(10,"div",5)(11,"label",6),e.EFF(12,"End Date"),e.k0s(),e.nrm(13,"input",8),e.k0s(),e.j41(14,"div",5)(15,"label",9),e.EFF(16,"County"),e.k0s(),e.j41(17,"p-multiSelect",10),e.bIt("ngModelChange",function(i){return t.selectedCounty=i})("onChange",function(i){return t.filter(i.value)}),e.k0s()(),e.j41(18,"div",5)(19,"label",9),e.EFF(20,"Sub County"),e.k0s(),e.j41(21,"p-multiSelect",11),e.bIt("ngModelChange",function(i){return t.selectedSubcounty=i})("onChange",function(i){return t.filterWards(i.value)}),e.k0s()(),e.j41(22,"div",5)(23,"label",9),e.EFF(24,"Ward"),e.k0s(),e.j41(25,"p-multiSelect",12),e.bIt("ngModelChange",function(i){return t.selectedWard=i}),e.k0s()(),e.j41(26,"div",5)(27,"label",9),e.EFF(28,"Group"),e.k0s(),e.j41(29,"p-multiSelect",13),e.bIt("ngModelChange",function(i){return t.selectedGroup=i}),e.k0s()()()()()(),e.j41(30,"div",14)(31,"div",15)(32,"div",16),e.EFF(33,"Date"),e.k0s(),e.j41(34,"div",17),e.EFF(35,"Course"),e.k0s(),e.j41(36,"div",17),e.EFF(37,"Module"),e.k0s(),e.j41(38,"div",16),e.EFF(39,"Trainer"),e.k0s(),e.j41(40,"div",16),e.EFF(41,"VLC"),e.k0s(),e.j41(42,"div",16),e.EFF(43,"Training Date"),e.k0s(),e.j41(44,"div",18),e.EFF(45,"Actions"),e.k0s()(),e.DNE(46,$,21,8,"div",19),e.j41(47,"div",20)(48,"p"),e.EFF(49),e.k0s(),e.j41(50,"div")(51,"ngb-pagination",21),e.bIt("pageChange",function(i){return t.setPage(i)})("pageChange",function(i){return t.dataParams.page_num=i}),e.k0s()()()()()),2&a&&(e.Y8G("breadcrumbItems",t.breadCrumbItems)("breadcrumbItems",t.breadCrumbItems),e.R7$(4),e.Y8G("formGroup",t.searchForm),e.R7$(13),e.Y8G("options",t.counties)("ngModel",t.selectedCounty),e.R7$(4),e.Y8G("options",t.subcountyOptions)("ngModel",t.selectedSubcounty),e.R7$(4),e.Y8G("options",t.wardOptions)("ngModel",t.selectedWard),e.R7$(4),e.Y8G("options",t.myGroups)("ngModel",t.selectedGroup),e.R7$(17),e.Y8G("ngForOf",t.trainings),e.R7$(3),e.E5c(" Showing ",1===t.dataParams.page_size?1:t.dataParams.page_num*t.dataParams.page_size-10," to ",t.dataParams.page_num*t.dataParams.page_size," of ",200," entries "),e.R7$(2),e.Y8G("collectionSize",200)("page",t.dataParams.page_num)("maxSize",5)("boundaryLinks",!0))},dependencies:[v.G,F.T,o.X1,o.qT,o.me,o.BC,o.cb,o.j4,o.JD,o.YN,c.Kj,f.MQ,p.MD,p.Sq,p.vh,g.s5,b.iV,b.KF,C.D]})}return n})();var S=l(9896);function O(n,u){if(1&n){const r=e.RV6();e.j41(0,"div",26)(1,"div",27),e.EFF(2),e.k0s(),e.j41(3,"div",28),e.EFF(4),e.k0s(),e.j41(5,"div",29),e.EFF(6),e.k0s(),e.j41(7,"div",28),e.EFF(8),e.k0s(),e.j41(9,"div",27),e.EFF(10),e.k0s(),e.j41(11,"div",27),e.qSk(),e.j41(12,"svg",30),e.bIt("click",function(){const s=e.eBV(r).$implicit,i=e.XpG();return e.Njj(i.viewGroupDetails(s))}),e.j41(13,"g",31),e.nrm(14,"circle",32)(15,"path",33),e.k0s()(),e.j41(16,"svg",34),e.nrm(17,"path",35),e.k0s()()()}if(2&n){const r=u.$implicit;e.R7$(2),e.JRh(null==r?null:r.group_id),e.R7$(2),e.JRh(null==r?null:r.group_name),e.R7$(2),e.JRh(null==r?null:r.description),e.R7$(2),e.SpI(" ",null==r?null:r.group_admin.name," "),e.R7$(2),e.SpI(" ",null==r?null:r.group_admin.msisdn," ")}}let z=(()=>{class n{constructor(r,a,t,s){this.formBuilder=r,this.cdr=a,this.groupsService=t,this.router=s,this.counties=[],this.sub_counties=[],this.wards=[],this.groups=[],this.ColumnMode=c.oZ,this.columns=[],this.dataParams={page_num:"",page_size:""},this.size=1,this.limit=10,this.totalGroups=0,this.selectedCounty=[],this.myCounties=[],this.subcountyOptions=[{subCountyId:1,name:"Select a subcounty"}],this.wardOptions=[{wardId:1,name:"Select a ward"}],this.myGroups=[{subCountyId:1,name:"Select a group"}],this.selectedSubcounty=[],this.selectedWard=[],this.selectedGroup=[]}ngOnInit(){const r=new Date,a=new Date;a.setMonth(a.getMonth()-5),this.dataParams.page_num=1,this.dataParams.page_size=10,this.counties=h.v,this.myCounties=this.transformCounties(h.v),this.breadCrumbItems=[{label:"Reports"},{label:"Groups",active:!0}],this.searchForm=this.formBuilder.group({start_date:[this.formatDate(a),o.k0.required],end_date:[this.formatDate(r),o.k0.required],countyId:[[],o.k0.required],subCountyId:[[],o.k0.required],wardId:[[],o.k0.required],groupId:[[],o.k0.required]}),this.getGroups(),this.searchForm.valueChanges.subscribe(()=>{let t={countyId:this.searchForm.get("countyId")?.value.map(i=>i.county_id),subCountyId:this.searchForm.get("subCountyId")?.value.map(i=>i.subCountyId),wardId:this.searchForm.get("wardId")?.value.map(i=>i.wardId),groupId:this.searchForm.get("groupId")?.value.map(i=>i.group_id),startDate:this.searchForm.get("start_date")?.value?this.searchForm.get("start_date")?.value:"",endDate:this.searchForm.get("end_date")?.value?this.searchForm.get("end_date")?.value:""};this.filterGroups({page:this.dataParams.page_num,dataObj:t,size:this.dataParams.page_size})})}filter(r){const a=r?.map(t=>t.county_id);if(a){const t=this.counties.filter(s=>a.includes(s.county_id)).flatMap(s=>s.sub_counties);console.log(t),this.subcountyOptions=[{subCountyId:1,name:"Select a subcounty"},...t],this.wardOptions=[{wardId:1,name:"Select a ward"}]}}filterWards(r){this.wardOptions=[{wardId:1,name:"Select a ward"}],r.forEach(a=>{a&&a.wards&&this.wardOptions.push(...a.wards)})}transformCounties(r){return r.map(a=>({label:a.name,value:a.county_id}))}edit(r){console.log(r)}onPageChange(r){this.size=r,this.getGroups()}formatDate(r){let a=new Date(r),t=""+(a.getMonth()+1),s=""+a.getDate(),i=a.getFullYear();return t.length<2&&(t="0"+t),s.length<2&&(s="0"+s),[i,t,s].join("-")}viewGroupDetails(r){console.log(r),sessionStorage.setItem("selected",JSON.stringify(r)),this.router.navigate(["/groups/group/",r.group_id])}getGroups(){this.groupsService.getGroups(this.size,this.limit).subscribe(r=>{200==r.statusCode&&(this.totalGroups=200,this.groups=r.message,this.cdr.markForCheck())})}onSubmit(){}filtergroups(r){this.groupsService.getGroupsByLocation(r).subscribe(a=>{200==a.statusCode&&(console.log(a),this.groups=a.message,this.cdr.markForCheck())})}filterGroups(r){this.groupsService.getGroupsByLocation(r).subscribe(a=>{200==a.statusCode&&(this.groups=a.message,this.cdr.markForCheck())})}search(){let r={countyId:this.searchForm.get("countyId")?.value,subCountyId:this.searchForm.get("subCountyId")?.value,wardId:this.searchForm.get("wardId")?.value,startDate:"",endDate:""};this.filterGroups(r)}subCounties(){let r=this.searchForm.get("countyId")?.value;this.counties.filter(t=>r.includes(t.county_id)).forEach(t=>{this.sub_counties=this.sub_counties.concat(t.sub_counties)}),this.search()}getWards(){let r=this.searchForm.get("subCountyId")?.value;this.sub_counties.filter(t=>r.includes(t.subCountyId)).forEach(t=>{this.wards=this.wards.concat(t.wards)}),this.search()}onGroupSelect(){this.search()}setPage(r){this.dataParams.page_num=r;let a={countyId:this.searchForm.get("countyId")?.value.map(s=>s.county_id),subCountyId:this.searchForm.get("subCountyId")?.value.map(s=>s.subCountyId),wardId:this.searchForm.get("wardId")?.value.map(s=>s.wardId),groupId:this.searchForm.get("groupId")?.value.map(s=>s.group_id),startDate:this.searchForm.get("start_date")?.value?this.searchForm.get("start_date")?.value:"",endDate:this.searchForm.get("end_date")?.value?this.searchForm.get("end_date")?.value:""};this.groupsService.getGroupsByLocation({page:this.dataParams.page_num,dataObj:a,size:this.dataParams.page_size}).subscribe(s=>{this.groups=s.message,this.cdr.markForCheck()})}exportAllGroups(){this.groupsService.exportAllGroups({page:1,size:250}).subscribe(a=>{const t=document.createElement("a"),s=URL.createObjectURL(a);t.href=s,t.download="groups.xlsx",t.click(),URL.revokeObjectURL(s),this.cdr.markForCheck()})}static#e=this.\u0275fac=function(a){return new(a||n)(e.rXU(o.ok),e.rXU(e.gRc),e.rXU(S.U),e.rXU(_.Ix))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-groups"]],standalone:!0,features:[e.aNF],decls:52,vars:17,consts:[["title","Reports",3,"breadcrumbItems"],[1,"card"],[1,"card-body"],[1,"col-lg-12","d-flex","w-100",3,"formGroup"],[1,"d-flex","flex-sm-column","flex-md-column","flex-lg-row","flex-wrap","justify-content-between","w-100"],[1,"d-flex","flex-column"],["for","example-datetime-local-input",1,"form-label"],["type","date","placeholder","Start","formControlName","start_date","id","example-datetime-local-input",1,"form-control",2,"width","180px !important"],["type","date","placeholder","End","formControlName","end_date","id","example-datetime-local-input",1,"form-control",2,"width","180px !important"],["for","county"],["formControlName","countyId","optionLabel","name","placeholder","Select county",1,"fixed-width-multiselect",3,"options","ngModel","ngModelChange","onChange"],["formControlName","subCountyId","optionLabel","name","placeholder","Select a subcounty",3,"options","ngModel","ngModelChange","onChange"],["formControlName","wardId","optionLabel","name","placeholder","Select a ward",3,"options","ngModel","ngModelChange"],[2,"margin-top","20px","width","100%","padding-left","0px","display","flex","align-items","center","justify-content","end","gap","20px"],[1,"d-flex","align-items-center","flex-row","gap-2",2,"cursor","pointer",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","viewBox","0 0 24 24"],["fill","#3fc057","d","M15.707 13.293a1 1 0 0 0-1.414 0L13 14.586V3a1 1 0 0 0-2 0v11.586l-1.293-1.293a1 1 0 0 0-1.414 1.414l3 3a1 1 0 0 0 1.414 0l3-3a1 1 0 0 0 0-1.414"],["fill","#3fc057","d","M18 9h-5v5.586l1.293-1.293a1 1 0 0 1 1.414 1.414l-3 3a1 1 0 0 1-1.414 0l-3-3a1 1 0 0 1 1.414-1.414L11 14.586V9H6a3.003 3.003 0 0 0-3 3v7a3.003 3.003 0 0 0 3 3h12a3.003 3.003 0 0 0 3-3v-7a3.003 3.003 0 0 0-3-3","opacity","0.5"],[2,"background-color","white","padding-left","10px","padding-right","10px","padding-top","10px","padding-bottom","10px","margin-bottom","10px"],[1,"d-flex","align-items-center",2,"width","100%","height","50px","border-bottom","1px solid #e9e9ef","font-weight","bold"],[2,"width","10%"],[2,"width","20%"],[2,"width","30%"],["class","d-flex flex-row align-items-center","style","height: 50px; border-bottom: 1px solid #e9e9ef",4,"ngFor","ngForOf"],[2,"display","flex","align-items","center","justify-content","space-between","width","100%","height","80px","margin-top","20px"],[3,"collectionSize","page","maxSize","boundaryLinks","pageChange"],[1,"d-flex","flex-row","align-items-center",2,"height","50px","border-bottom","1px solid #e9e9ef"],[2,"width","10%","font-size","12px"],[2,"width","20%","font-size","12px"],[2,"width","30%","font-size","12px"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24",2,"cursor","pointer","margin-right","10px",3,"click"],["fill","none","stroke","#000"],["cx","12","cy","12","r","3.5"],["d","M20.188 10.934c.388.472.582.707.582 1.066c0 .359-.194.594-.582 1.066C18.768 14.79 15.636 18 12 18c-3.636 0-6.768-3.21-8.188-4.934c-.388-.472-.582-.707-.582-1.066c0-.359.194-.594.582-1.066C5.232 9.21 8.364 6 12 6c3.636 0 6.768 3.21 8.188 4.934Z"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24",2,"cursor","pointer"],["fill","none","stroke","#000","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","m14.304 4.844l2.852 2.852M7 7H4a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h11a1 1 0 0 0 1-1v-4.5m2.409-9.91a2.017 2.017 0 0 1 0 2.853l-6.844 6.844L8 14l.713-3.565l6.844-6.844a2.015 2.015 0 0 1 2.852 0Z"]],template:function(a,t){1&a&&(e.nrm(0,"app-pagetitle",0),e.j41(1,"div")(2,"div",1)(3,"div",2)(4,"form",3)(5,"div",4)(6,"div",5)(7,"label",6),e.EFF(8,"Start Date"),e.k0s(),e.nrm(9,"input",7),e.k0s(),e.j41(10,"div",5)(11,"label",6),e.EFF(12,"End Date"),e.k0s(),e.nrm(13,"input",8),e.k0s(),e.j41(14,"div",5)(15,"label",9),e.EFF(16,"County"),e.k0s(),e.j41(17,"p-multiSelect",10),e.bIt("ngModelChange",function(i){return t.selectedCounty=i})("onChange",function(i){return t.filter(i.value)}),e.k0s()(),e.j41(18,"div",5)(19,"label",9),e.EFF(20,"Sub County"),e.k0s(),e.j41(21,"p-multiSelect",11),e.bIt("ngModelChange",function(i){return t.selectedSubcounty=i})("onChange",function(i){return t.filterWards(i.value)}),e.k0s()(),e.j41(22,"div",5)(23,"label",9),e.EFF(24,"Ward"),e.k0s(),e.j41(25,"p-multiSelect",12),e.bIt("ngModelChange",function(i){return t.selectedWard=i}),e.k0s()()()(),e.j41(26,"div",13)(27,"p",14),e.bIt("click",function(){return t.exportAllGroups()}),e.qSk(),e.j41(28,"svg",15),e.nrm(29,"path",16)(30,"path",17),e.k0s(),e.EFF(31," Export all groups "),e.k0s()()()(),e.joV(),e.j41(32,"div",18)(33,"div",19)(34,"div",20),e.EFF(35,"#Id"),e.k0s(),e.j41(36,"div",21),e.EFF(37,"Name"),e.k0s(),e.j41(38,"div",22),e.EFF(39,"Description"),e.k0s(),e.j41(40,"div",21),e.EFF(41,"Group Admin"),e.k0s(),e.j41(42,"div",20),e.EFF(43,"Admin Mobile"),e.k0s(),e.j41(44,"div",20),e.EFF(45,"Actions"),e.k0s()(),e.DNE(46,O,18,5,"div",23),e.j41(47,"div",24)(48,"p"),e.EFF(49),e.k0s(),e.j41(50,"div")(51,"ngb-pagination",25),e.bIt("pageChange",function(i){return t.setPage(i)})("pageChange",function(i){return t.dataParams.page_num=i}),e.k0s()()()()()),2&a&&(e.Y8G("breadcrumbItems",t.breadCrumbItems)("breadcrumbItems",t.breadCrumbItems),e.R7$(4),e.Y8G("formGroup",t.searchForm),e.R7$(13),e.Y8G("options",t.counties)("ngModel",t.selectedCounty),e.R7$(4),e.Y8G("options",t.subcountyOptions)("ngModel",t.selectedSubcounty),e.R7$(4),e.Y8G("options",t.wardOptions)("ngModel",t.selectedWard),e.R7$(21),e.Y8G("ngForOf",t.groups),e.R7$(3),e.E5c(" Showing ",1===t.dataParams.page_size?1:t.dataParams.page_num*t.dataParams.page_size-10," to ",t.dataParams.page_num*t.dataParams.page_size," of ",200," entries "),e.R7$(2),e.Y8G("collectionSize",3e3)("page",t.dataParams.page_num)("maxSize",5)("boundaryLinks",!0))},dependencies:[v.G,F.T,o.X1,o.qT,o.me,o.BC,o.cb,o.j4,o.JD,o.YN,f.MQ,c.Kj,g.s5,p.MD,p.Sq,b.iV,b.KF,C.D]})}return n})();function L(n,u){1&n&&(e.qSk(),e.j41(0,"svg",25)(1,"g",26),e.nrm(2,"circle",27)(3,"path",28),e.k0s()(),e.j41(4,"svg",29),e.nrm(5,"path",30),e.k0s())}let U=(()=>{class n{constructor(r,a,t,s){this.formBuilder=r,this.cdr=a,this.groupsService=t,this.router=s,this.counties=[],this.sub_counties=[],this.wards=[],this.groups=[],this.ColumnMode=c.oZ,this.columns=[],this.dataParams={page_num:"",page_size:""},this.size=1,this.limit=10,this.totalGroups=0,this.totalSeedDistributionReports=0,this.seedDistributionOverview=[]}ngOnInit(){const r=new Date,a=new Date;a.setMonth(a.getMonth()-1),this.dataParams.page_num=0,this.dataParams.page_size=10,this.counties=h.v,this.breadCrumbItems=[{label:"Reports"},{label:"Seed Distribution",active:!0}],this.searchForm=this.formBuilder.group({start_date:[this.formatDate(a),o.k0.required],end_date:[this.formatDate(r),o.k0.required],countyId:[[],o.k0.required],subCountyId:[[],o.k0.required],wardId:[[],o.k0.required],groupId:[[],o.k0.required]}),this.fetchSeedDistributionOverview()}edit(r){console.log(r)}onPageChange(r){this.size=r,this.fetchSeedDistributionOverview()}formatDate(r){let a=new Date(r),t=""+(a.getMonth()+1),s=""+a.getDate(),i=a.getFullYear();return t.length<2&&(t="0"+t),s.length<2&&(s="0"+s),[i,t,s].join("-")}fetchSeedDistributionOverview(){this.searchForm.get("countyId"),this.searchForm.get("subCountyId"),this.searchForm.get("wardId"),this.searchForm.get("start_date"),this.searchForm.get("end_date"),this.groupsService.getSeedDistributionReport().subscribe(a=>{200==a.statusCode&&(this.totalSeedDistributionReports=200,this.seedDistributionOverview=a.message,this.cdr.markForCheck())})}search(){this.fetchSeedDistributionOverview()}subCounties(){let r=this.searchForm.get("countyId")?.value;this.counties.filter(t=>r.includes(t.county_id)).forEach(t=>{this.sub_counties=this.sub_counties.concat(t.sub_counties)})}filterWards(r){let a=this.searchForm.get("subCountyId")?.value;this.sub_counties.filter(s=>a.includes(s.subCountyId)).forEach(s=>{this.wards=this.wards.concat(s.wards)})}getWards(){let r=this.searchForm.get("subCountyId")?.value;this.sub_counties.filter(t=>r.includes(t.subCountyId)).forEach(t=>{this.wards=this.wards.concat(t.wards)})}setPage(r){console.log(r),this.dataParams.page_num=r.offset+1,this.groupsService.getDynamicGroups(this.dataParams.page_num).subscribe(a=>{this.groups=a.message,this.cdr.markForCheck()})}static#e=this.\u0275fac=function(a){return new(a||n)(e.rXU(o.ok),e.rXU(e.gRc),e.rXU(S.U),e.rXU(_.Ix))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-seeds-distribution"]],standalone:!0,features:[e.aNF],decls:41,vars:21,consts:[["title","Seed Distribution Report",3,"breadcrumbItems"],[1,"card"],[1,"card-body"],[3,"formGroup"],[1,"row"],[1,"col-xl","col-md-6"],["for","example-datetime-local-input",1,"form-label"],["type","date","placeholder","Start","formControlName","start_date","id","example-datetime-local-input",1,"form-control"],[1,"col-xl-2","col-md-6"],["type","date","placeholder","End","formControlName","end_date","id","example-datetime-local-input",1,"form-control"],[1,"form-group"],["bindLabel","name","bindValue","county_id","placeholder","Select County","formControlName","countyId",3,"items","virtualScroll","multiple","change"],["bindLabel","name","bindValue","subCountyId","placeholder","Select Sub County","formControlName","subCountyId",3,"items","virtualScroll","multiple","change"],["bindLabel","name","bindValue","wardId","placeholder","Select Ward","formControlName","wardId",3,"items","virtualScroll","multiple"],[2,"margin-top","20px","margin-bottom","10px","width","100%"],["type","text","placeholder","Search with seed distribution id",2,"border","1px solid #e9e9ef","border-radius","5px","width","100%","height","40px","padding-left","10px","padding-right","10px"],[1,"bootstrap","core-bootstrap",3,"rows","rowHeight","columnMode","headerHeight","footerHeight","externalPaging","count","offset","limit","page"],["table",""],["name","#Id Number","prop","idNumber"],["name","User Id","prop","userId"],["name","Recipient","prop","recipientType"],["name","Distributor","prop","distributor"],["name","Value Chains","prop","vc.length"],["name","Details","prop","edit"],["ngx-datatable-cell-template",""],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24",2,"cursor","pointer","margin-right","10px"],["fill","none","stroke","#000"],["cx","12","cy","12","r","3.5"],["d","M20.188 10.934c.388.472.582.707.582 1.066c0 .359-.194.594-.582 1.066C18.768 14.79 15.636 18 12 18c-3.636 0-6.768-3.21-8.188-4.934c-.388-.472-.582-.707-.582-1.066c0-.359.194-.594.582-1.066C5.232 9.21 8.364 6 12 6c3.636 0 6.768 3.21 8.188 4.934Z"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24",2,"cursor","pointer"],["fill","none","stroke","#000","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","m14.304 4.844l2.852 2.852M7 7H4a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h11a1 1 0 0 0 1-1v-4.5m2.409-9.91a2.017 2.017 0 0 1 0 2.853l-6.844 6.844L8 14l.713-3.565l6.844-6.844a2.015 2.015 0 0 1 2.852 0Z"]],template:function(a,t){1&a&&(e.nrm(0,"app-pagetitle",0),e.j41(1,"div")(2,"div",1)(3,"div",2)(4,"form",3)(5,"div",4)(6,"div",5)(7,"label",6),e.EFF(8,"Start Date"),e.k0s(),e.nrm(9,"input",7),e.k0s(),e.j41(10,"div",8)(11,"label",6),e.EFF(12,"End Date"),e.k0s(),e.nrm(13,"input",9),e.k0s(),e.j41(14,"div",5)(15,"label",6),e.EFF(16,"Counties"),e.k0s(),e.j41(17,"div",10)(18,"ng-select",11),e.bIt("change",function(){return t.subCounties()}),e.k0s()()(),e.j41(19,"div",5)(20,"label",6),e.EFF(21,"Sub counties"),e.k0s(),e.j41(22,"div",10)(23,"ng-select",12),e.bIt("change",function(){return t.getWards()}),e.k0s()()(),e.j41(24,"div",5)(25,"label",6),e.EFF(26,"wards"),e.k0s(),e.j41(27,"div",10),e.nrm(28,"ng-select",13),e.k0s()()()(),e.j41(29,"div",14),e.nrm(30,"input",15),e.k0s()()(),e.j41(31,"div",1)(32,"ngx-datatable",16,17),e.bIt("page",function(i){return t.setPage(i)}),e.nrm(34,"ngx-datatable-column",18)(35,"ngx-datatable-column",19)(36,"ngx-datatable-column",20)(37,"ngx-datatable-column",21)(38,"ngx-datatable-column",22),e.j41(39,"ngx-datatable-column",23),e.DNE(40,L,6,0,"ng-template",24),e.k0s()()()()),2&a&&(e.Y8G("breadcrumbItems",t.breadCrumbItems)("breadcrumbItems",t.breadCrumbItems),e.R7$(4),e.Y8G("formGroup",t.searchForm),e.R7$(14),e.Y8G("items",t.counties)("virtualScroll",!0)("multiple",!0),e.R7$(5),e.Y8G("items",t.sub_counties)("virtualScroll",!0)("multiple",!0),e.R7$(5),e.Y8G("items",t.wards)("virtualScroll",!0)("multiple",!0),e.R7$(4),e.Y8G("rows",t.seedDistributionOverview)("rowHeight",50)("columnMode",t.ColumnMode.force)("headerHeight",50)("footerHeight",50)("externalPaging",!0)("count",0)("offset",t.dataParams.page_num)("limit",t.dataParams.page_size))},dependencies:[v.G,F.T,o.X1,o.qT,o.me,o.BC,o.cb,o.j4,o.JD,o.YN,f.MQ,f.vr,c.Kj,c.ge,c.ed,c.QI]})}return n})();var B=l(1994);function Y(n,u){if(1&n&&(e.j41(0,"option",77),e.EFF(1),e.nI1(2,"titlecase"),e.k0s()),2&n){const r=u.$implicit;e.Y8G("value",r.name.toUpperCase()),e.R7$(1),e.SpI(" ",e.bMT(2,2,r.name)," ")}}function q(n,u){if(1&n&&(e.j41(0,"option",78),e.EFF(1),e.k0s()),2&n){const r=u.$implicit;e.R7$(1),e.SpI(" ",r.name," ")}}function V(n,u){if(1&n&&(e.j41(0,"option",79),e.EFF(1),e.k0s()),2&n){const r=u.$implicit;e.R7$(1),e.SpI(" ",r.name," ")}}function X(n,u){if(1&n){const r=e.RV6();e.j41(0,"div")(1,"div",41)(2,"h5",42),e.EFF(3,"Edit Tot"),e.k0s(),e.j41(4,"button",43),e.bIt("click",function(){const s=e.eBV(r).$implicit;return e.Njj(s.dismiss("Cross click"))}),e.k0s()(),e.j41(5,"div",44)(6,"form",45),e.bIt("ngSubmit",function(t){e.eBV(r);const s=e.XpG(2);return e.Njj(s.handleSubmit(t))}),e.j41(7,"div",46)(8,"div",47)(9,"div",48)(10,"label",49),e.EFF(11,"First Name"),e.k0s(),e.nrm(12,"input",50),e.k0s(),e.j41(13,"div",48)(14,"label",51),e.EFF(15,"Last Name"),e.k0s(),e.nrm(16,"input",52),e.k0s(),e.j41(17,"div",48)(18,"label",51),e.EFF(19,"Email"),e.k0s(),e.nrm(20,"input",53),e.k0s(),e.j41(21,"div",48)(22,"label",54),e.EFF(23,"ID Number"),e.k0s(),e.nrm(24,"input",55),e.k0s(),e.j41(25,"div",48)(26,"label",56),e.EFF(27,"Date of Birth"),e.k0s(),e.nrm(28,"input",57),e.k0s()(),e.j41(29,"div",47)(30,"div",48)(31,"label",58),e.EFF(32,"Phone Number"),e.k0s(),e.nrm(33,"input",59),e.k0s(),e.j41(34,"div",48)(35,"label",60),e.EFF(36,"Gender"),e.k0s(),e.j41(37,"select",61)(38,"option",62),e.EFF(39,"Male"),e.k0s(),e.j41(40,"option",63),e.EFF(41,"Female"),e.k0s()()(),e.j41(42,"div",64)(43,"div",65)(44,"label",66),e.EFF(45,"County"),e.k0s(),e.j41(46,"select",67),e.DNE(47,Y,3,4,"option",68),e.k0s()(),e.j41(48,"div",65)(49,"label",69),e.EFF(50,"Sub County"),e.k0s(),e.j41(51,"select",70),e.DNE(52,q,2,1,"option",71),e.k0s()(),e.j41(53,"div",65)(54,"label",72),e.EFF(55,"Ward"),e.k0s(),e.j41(56,"select",73),e.DNE(57,V,2,1,"option",74),e.k0s()()()()(),e.j41(58,"div",75)(59,"button",76),e.EFF(60," Update Tot "),e.k0s()()()()()}if(2&n){const r=e.XpG(2);e.R7$(6),e.Y8G("formGroup",r.updateForm),e.R7$(41),e.Y8G("ngForOf",r.counties),e.R7$(5),e.Y8G("ngForOf",r.sub_counties),e.R7$(5),e.Y8G("ngForOf",r.wards)}}function W(n,u){if(1&n){const r=e.RV6();e.j41(0,"div",29)(1,"div",22)(2,"input",30),e.bIt("change",function(t){const i=e.eBV(r).$implicit,d=e.XpG();return e.Njj(d.onRowSelect(t,i))}),e.k0s()(),e.j41(3,"div",31),e.EFF(4),e.k0s(),e.j41(5,"div",32),e.EFF(6),e.k0s(),e.j41(7,"div",32),e.EFF(8),e.k0s(),e.j41(9,"div",32),e.EFF(10),e.k0s(),e.j41(11,"div",32),e.EFF(12),e.k0s(),e.j41(13,"div",32),e.EFF(14),e.k0s(),e.j41(15,"div",32),e.EFF(16),e.k0s(),e.j41(17,"div",32),e.EFF(18),e.k0s(),e.j41(19,"div",32),e.EFF(20),e.k0s(),e.j41(21,"div",33),e.qSk(),e.j41(22,"svg",34),e.bIt("click",function(){const s=e.eBV(r).$implicit,i=e.XpG();return e.Njj(i.view(s))}),e.j41(23,"g",35),e.nrm(24,"circle",36)(25,"path",37),e.k0s()(),e.j41(26,"svg",38),e.bIt("click",function(){const s=e.eBV(r).$implicit,i=e.sdS(30),d=e.XpG();return e.Njj(d.centerModal(i,s))}),e.nrm(27,"path",39),e.k0s(),e.joV(),e.j41(28,"div"),e.DNE(29,X,61,4,"ng-template",null,40,e.C5r),e.k0s()()()}if(2&n){const r=u.$implicit,a=e.XpG();e.R7$(2),e.Y8G("checked",a.isSelected((null==r?null:r.member_id)||(null==r?null:r.userId))),e.R7$(2),e.SpI(" ",r.member_id||(null==r?null:r.userId)," "),e.R7$(2),e.Lme(" ",r.first_name||(null==r?null:r.firstName)," ",r.last_name||(null==r?null:r.lastName)," "),e.R7$(2),e.SpI(" ",r.msisdn," "),e.R7$(2),e.SpI(" ",r.gender," "),e.R7$(2),e.SpI(" ",r.dob," "),e.R7$(2),e.SpI(" ",1===r.isActive?"Active":"Inactive"," "),e.R7$(2),e.SpI(" ",r.county_title||(null==r?null:r.countyTitle)," "),e.R7$(2),e.SpI(" ",r.subcountyTitle||(null==r?null:r.subCountyTitle)," "),e.R7$(2),e.SpI(" ",r.id_number||(null==r?null:r.idNumber)," ")}}const A=[{path:"farmers",component:G},{path:"trainings",component:P},{path:"groups",component:z},{path:"seeds-distribution",component:U},{path:"tots",component:(()=>{class n{constructor(r,a,t,s,i,d,m,J){this.formBuilder=r,this.cdr=a,this.totsService=t,this.usersService=s,this.groupsService=i,this.router=d,this.modalService=m,this.toastr=J,this.currentPage=1,this.counties=[],this.sub_counties=[],this.wards=[],this.ColumnMode=c.oZ,this.rows=[],this.selectedTrainer={},this.totalCounts=1,this.selectedRows=new Set,this.groups=[],this.dataParams={page_num:1,page_size:10},this.selectedCounty=[],this.myCounties=[],this.subcountyOptions=[{subCountyId:1,name:"Select a subcounty"}],this.wardOptions=[{wardId:1,name:"Select a ward"}],this.myGroups=[{subCountyId:1,name:"Select a group"}],this.selectedSubcounty=[],this.selectedWard=[],this.selectedGroup=[]}ngOnInit(){const r=new Date,a=new Date;a.setMonth(a.getMonth()-5),this.dataParams.page_num=1,this.dataParams.page_size=10,this.counties=h.v,this.myCounties=this.transformCounties(h.v),this.breadCrumbItems=[{label:"Reports"},{label:"ToTs",active:!0}],this.searchForm=this.formBuilder.group({startDate:[this.formatDate(a),o.k0.required],endDate:[this.formatDate(r),o.k0.required],countyId:[[],o.k0.required],subCountyId:[[],o.k0.required],wardId:[[],o.k0.required]}),this.updateForm=this.formBuilder.group({dob:["",o.k0.required],email:["",o.k0.required],gender:["",o.k0.required],msisdn:["",o.k0.required],idNumber:["",o.k0.required],lastName:["",o.k0.required],firstName:["",o.k0.required],wardTitle:["",o.k0.required],countyTitle:["",o.k0.required],subCountyTitle:["",o.k0.required]}),this.searchForm.valueChanges.subscribe(()=>{let i={countyId:this.searchForm.get("countyId")?.value.map(m=>m.county_id),subCountyId:this.searchForm.get("subCountyId")?.value.map(m=>m.subCountyId),wardId:this.searchForm.get("wardId")?.value.map(m=>m.wardId),groupId:this.searchForm.get("groupId")?.value.map(m=>m.group_id),startDate:this.searchForm.get("startDate")?.value?this.searchForm.get("startDate")?.value:"",endDate:this.searchForm.get("endDate")?.value?this.searchForm.get("endDate")?.value:"",userTypeId:2},d={page:this.dataParams.page_num,dataObj:i,size:this.dataParams.page_size};this.filterGroups(i),this.onSubmit(d)});let t={countyId:this.searchForm.get("countyId")?.value.map(i=>i.county_id),subCountyId:this.searchForm.get("subCountyId")?.value.map(i=>i.subCountyId),wardId:this.searchForm.get("wardId")?.value.map(i=>i.wardId),groupId:this.searchForm.get("groupId")?.value.map(i=>i.group_id),startDate:this.searchForm.get("startDate")?.value?this.searchForm.get("startDate")?.value:"",endDate:this.searchForm.get("endDate")?.value?this.searchForm.get("endDate")?.value:"",userTypeId:2};this.onSubmit({page:this.dataParams.page_num,dataObj:t,size:this.dataParams.page_size})}filter(r){const a=r?.map(t=>t.county_id);if(a){const t=this.counties.filter(s=>a.includes(s.county_id)).flatMap(s=>s.sub_counties);console.log(t),this.subcountyOptions=[{subCountyId:1,name:"Select a subcounty"},...t],this.wardOptions=[{wardId:1,name:"Select a ward"}]}}filterWards(r){this.wardOptions=[{wardId:1,name:"Select a ward"}],r.forEach(a=>{a&&a.wards&&this.wardOptions.push(...a.wards)})}transformCounties(r){return r.map(a=>({label:a.name,value:a.county_id}))}handleSubmit(r){var a=this;return(0,k.A)(function*(){r.preventDefault(),a.updateForm.valid&&a.usersService.updateUserById(a.selectedTrainer.userId??0,{firstName:a.updateForm.value.firstName,lastName:a.updateForm.value.lastName,gender:a.updateForm.value.gender,idNumber:a.updateForm.value.idNumber,dob:a.updateForm.value.dob,email:a.updateForm.value.email,msisdn:a.updateForm.value.msisdn,username:a.selectedTrainer?.username,userTypeId:2,password:"",wardId:a.selectedTrainer.wardId}).subscribe(s=>{a.toastr.success("Success","Tot updated successfully");let i={countyId:a.searchForm.get("countyId")?.value.map(m=>m.county_id),subCountyId:a.searchForm.get("subCountyId")?.value.map(m=>m.subCountyId),wardId:a.searchForm.get("wardId")?.value.map(m=>m.wardId),groupId:a.searchForm.get("groupId")?.value.map(m=>m.group_id),startDate:a.searchForm.get("startDate")?.value?a.searchForm.get("startDate")?.value:"",endDate:a.searchForm.get("endDate")?.value?a.searchForm.get("endDate")?.value:"",userTypeId:2};a.onSubmit({page:a.dataParams.page_num,dataObj:i,size:a.dataParams.page_size}),a.modalService.dismissAll()},s=>{console.error("Error:",s),a.toastr.error("Error","Failed to update user")})})()}selectAll(r){r.target.checked?this.rows.forEach(t=>this.selectedRows.add(t.member_id||t?.userId)):this.selectedRows.clear()}onRowSelect(r,a){r.target.checked?this.selectedRows.add(a.member_id||a?.userId):this.selectedRows.delete(a.member_id||a?.userId)}isSelected(r){return this.selectedRows?.has(r)}centerModal(r,a){console.log(a),this.selectedTrainer=a,void 0!==a.countyTitle&&(this.sub_counties=this.usersService.fetchSubCountiesWithName(a.countyTitle)),void 0!==a.subcountyTitle&&void 0!==a.countyTitle&&(this.wards=this.usersService.getWardsByName(a.countyTitle,a.subcountyTitle)),this.updateForm.patchValue({firstName:a.firstName,lastName:a.lastName,email:a.email,idNumber:a.idNumber,dob:a.dob?this.formatDate(new Date(a.dob)):null,msisdn:a.msisdn,gender:a.gender,countyTitle:a?.countyTitle?.toUpperCase(),subCountyTitle:a.subcountyTitle,wardTitle:a.wardTitle}),this.modalService.open(r,{centered:!0,windowClass:"modal-user-holder",size:"lg"})}formatDate(r){let a=new Date(r),t=""+(a.getMonth()+1),s=""+a.getDate(),i=a.getFullYear();return t.length<2&&(t="0"+t),s.length<2&&(s="0"+s),[i,t,s].join("-")}onSubmit(r){this.totsService.getTotsByLocations(r).subscribe(a=>{200==a.statusCode&&(this.rows=a.message.tots,this.totalCounts=a.message.totalCount,this.cdr.markForCheck())})}setPage(r){this.dataParams.page_num=r;let a={countyId:this.searchForm.get("countyId")?.value.map(s=>s.county_id),subCountyId:this.searchForm.get("subCountyId")?.value.map(s=>s.subCountyId),wardId:this.searchForm.get("wardId")?.value.map(s=>s.wardId),groupId:this.searchForm.get("groupId")?.value.map(s=>s.group_id),startDate:this.searchForm.get("start_date")?.value?this.searchForm.get("start_date")?.value:"",endDate:this.searchForm.get("end_date")?.value?this.searchForm.get("end_date")?.value:"",userTypeId:2};this.totsService.getTotsByLocations({page:this.dataParams.page_num,dataObj:a,size:this.dataParams.page_size}).subscribe(s=>{this.rows=s.message.tots,this.totalCounts=s.message.totalCount})}subCounties(r){let a=this.searchForm.get("countyId")?.value;this.counties.filter(s=>a.includes(s.county_id)).forEach(s=>{this.sub_counties=this.sub_counties.concat(s.sub_counties)})}onWardSelect(){}view(r){this.router.navigate([`users/${r.msisdn}`])}fetchSubcounties(r){return this.usersService.fetchSubCounties(r)}fetchWards(r){return this.usersService.getWards(r)}exportSelectedMembers(){let r={userId:Array.from(this.selectedRows)};this.totsService.exportMembers(r).subscribe(a=>{const t=document.createElement("a"),s=URL.createObjectURL(a);t.href=s,t.download="Tots.xlsx",t.click(),URL.revokeObjectURL(s),this.cdr.markForCheck(),this.cdr.markForCheck()})}exportEntireMembersReport(){let a={page:1,dataObj:{countyId:this.searchForm.get("countyId")?.value.map(t=>t.county_id),subCountyId:this.searchForm.get("subCountyId")?.value.map(t=>t.subCountyId),wardId:this.searchForm.get("wardId")?.value.map(t=>t.wardId),groupId:this.searchForm.get("groupId")?.value.map(t=>t.group_id),startDate:this.searchForm.get("start_date")?.value?this.searchForm.get("start_date")?.value:"",endDate:this.searchForm.get("end_date")?.value?this.searchForm.get("end_date")?.value:"",userTypeId:2},size:1e5};this.totsService.exportAllMembers(a).subscribe(t=>{const s=document.createElement("a"),i=URL.createObjectURL(t);s.href=i,s.download="Tots.xlsx",s.click(),URL.revokeObjectURL(i),this.cdr.markForCheck(),this.cdr.markForCheck()})}filterGroups(r){this.searchForm&&this.groupsService.getGroupsByLocation(r).subscribe(a=>{200==a.statusCode&&(this.groups=a.message,this.cdr.markForCheck(),this.myGroups=[{group_id:1,name:"Select a group"},...a.message.map(t=>({group_id:t.group_id,name:t.group_name,ward_id:t.ward_id,description:t.description,group_admin_name:t.group_admin.name}))])})}static#e=this.\u0275fac=function(a){return new(a||n)(e.rXU(o.ok),e.rXU(e.gRc),e.rXU(B.Y),e.rXU(I.g),e.rXU(w.U),e.rXU(_.Ix),e.rXU(g.Bq),e.rXU(x.tw))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-tots"]],standalone:!0,features:[e.aNF],decls:71,vars:18,consts:[["title","Reports",3,"breadcrumbItems"],[1,"card"],[1,"card-body"],[1,"col-lg-12","d-flex","w-100",3,"formGroup"],[1,"d-flex","flex-sm-column","flex-md-column","flex-lg-row","flex-wrap","justify-content-between","w-100"],[1,"d-flex","flex-column"],["for","example-datetime-local-input",1,"form-label"],["type","date","placeholder","Start","formControlName","startDate","id","example-datetime-local-input",1,"form-control",2,"width","180px !important"],["type","date","placeholder","End","formControlName","endDate","id","example-datetime-local-input",1,"form-control",2,"width","180px !important"],["for","county"],["formControlName","countyId","optionLabel","name","placeholder","Select county",1,"fixed-width-multiselect",3,"options","ngModel","ngModelChange","onChange"],["formControlName","subCountyId","optionLabel","name","placeholder","Select a subcounty",3,"options","ngModel","ngModelChange","onChange"],["formControlName","wardId","optionLabel","name","placeholder","Select a ward",3,"options","ngModel","ngModelChange"],["formControlName","groupId","optionLabel","name","placeholder","Select a group",3,"options","ngModel","ngModelChange"],[2,"margin-top","20px","width","100%","padding-left","0px","display","flex","align-items","center","justify-content","end","gap","20px"],[1,"d-flex","flex-row","align-items-center","gap-2",2,"cursor","pointer",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","viewBox","0 0 24 24"],["fill","#3fc057","d","M15.707 13.293a1 1 0 0 0-1.414 0L13 14.586V3a1 1 0 0 0-2 0v11.586l-1.293-1.293a1 1 0 0 0-1.414 1.414l3 3a1 1 0 0 0 1.414 0l3-3a1 1 0 0 0 0-1.414"],["fill","#3fc057","d","M18 9h-5v5.586l1.293-1.293a1 1 0 0 1 1.414 1.414l-3 3a1 1 0 0 1-1.414 0l-3-3a1 1 0 0 1 1.414-1.414L11 14.586V9H6a3.003 3.003 0 0 0-3 3v7a3.003 3.003 0 0 0 3 3h12a3.003 3.003 0 0 0 3-3v-7a3.003 3.003 0 0 0-3-3","opacity","0.5"],[1,"d-flex","align-items-center","flex-row","gap-2",2,"cursor","pointer",3,"click"],[2,"background-color","white","padding-left","10px","padding-right","10px","padding-top","10px","padding-bottom","10px","margin-bottom","10px"],[1,"d-flex","align-items-center",2,"width","100%","height","50px","border-bottom","1px solid #e9e9ef","font-weight","bold"],[2,"width","5%"],["type","checkbox","id","select_all",3,"change"],[2,"width","5%","font-size","15px"],[2,"width","10%","font-size","15px"],["class","d-flex flex-row align-items-center","style","height: 50px; border-bottom: 1px solid #e9e9ef",4,"ngFor","ngForOf"],[2,"display","flex","align-items","center","justify-content","space-between","width","100%","height","80px","margin-top","20px"],[3,"collectionSize","page","maxSize","boundaryLinks","pageChange"],[1,"d-flex","flex-row","align-items-center",2,"height","50px","border-bottom","1px solid #e9e9ef"],["type","checkbox",3,"checked","change"],[1,"text-truncate",2,"width","5%","font-size","12px"],[1,"text-truncate",2,"width","10%","font-size","12px"],[2,"width","10%"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24",2,"cursor","pointer","margin-right","10px",3,"click"],["fill","none","stroke","#000"],["cx","12","cy","12","r","3.5"],["d","M20.188 10.934c.388.472.582.707.582 1.066c0 .359-.194.594-.582 1.066C18.768 14.79 15.636 18 12 18c-3.636 0-6.768-3.21-8.188-4.934c-.388-.472-.582-.707-.582-1.066c0-.359.194-.594.582-1.066C5.232 9.21 8.364 6 12 6c3.636 0 6.768 3.21 8.188 4.934Z"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24",2,"cursor","pointer",3,"click"],["fill","none","stroke","#000","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","m14.304 4.844l2.852 2.852M7 7H4a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h11a1 1 0 0 0 1-1v-4.5m2.409-9.91a2.017 2.017 0 0 1 0 2.853l-6.844 6.844L8 14l.713-3.565l6.844-6.844a2.015 2.015 0 0 1 2.852 0Z"],["userModal",""],[1,"modal-header"],[1,"modal-title","mt-0"],["type","button","aria-hidden","true",1,"btn-close",3,"click"],[1,"modal-body"],[2,"width","100%",3,"formGroup","ngSubmit"],[2,"width","100%","display","flex","gap","20px"],[1,"d-flex","flex-column",2,"width","50%"],[1,"d-flex","flex-column",2,"margin-bottom","10px"],["for","firstname",2,"margin-bottom","0px"],["type","text","formControlName","firstName","id","firstname","placeholder","Enter First Name",2,"height","50px","width","100%","padding-left","10px","padding-right","10px","border","1px solid #e9e9ef","border-radius","5px"],["for","lastname",2,"margin-bottom","0px"],["type","text","formControlName","lastName","id","lastname","placeholder","Enter Last Name",2,"height","50px","width","100%","padding-left","10px","padding-right","10px","border","1px solid #e9e9ef","border-radius","5px"],["type","text","formControlName","email","id","lastname","placeholder","Enter Email",2,"height","50px","width","100%","padding-left","10px","padding-right","10px","border","1px solid #e9e9ef","border-radius","5px"],["for","idnumber",2,"margin-bottom","0px"],["type","text","formControlName","idNumber","id","idnumber","placeholder","Enter Id Number",2,"height","50px","width","100%","padding-left","10px","padding-right","10px","border","1px solid #e9e9ef","border-radius","5px"],["for","dateOfBirth",2,"margin-bottom","0px"],["type","date","formControlName","dob","id","dateOfBirth","placeholder","Enter date of birth",2,"height","50px","width","100%","padding-left","10px","padding-right","10px","border","1px solid #e9e9ef","border-radius","5px"],["for","phonenumber",2,"margin-bottom","0px"],["type","text","formControlName","msisdn","id","phonenumber","placeholder","Enter phone number",2,"height","50px","width","100%","padding-left","10px","padding-right","10px","border","1px solid #e9e9ef","border-radius","5px"],["for","gender",2,"margin-bottom","0px"],["formControlName","gender","id","gender","placeholder","Select gender","aria-label","Default select example",1,"form-select",2,"height","50px !important"],["value","Male"],["value","Female"],[2,"width","100%","display","flex","align-items","center","justify-content","space-between"],[1,"d-flex","flex-column",2,"margin-bottom","10px","width","30%"],["for","county",2,"margin-bottom","0px"],["formControlName","countyTitle","id","county","placeholder","Select county","aria-label","Default select example",1,"form-select",2,"height","50px !important"],[3,"value",4,"ngFor","ngForOf"],["for","subcounty",2,"margin-bottom","0px"],["formControlName","subCountyTitle","id","subcounty","placeholder","Select subcounty","aria-label","Default select example",1,"form-select",2,"height","50px !important"],["value","subcounty?.name",4,"ngFor","ngForOf"],["for","ward",2,"margin-bottom","0px"],["formControlName","wardTitle","id","ward","placeholder","Select ward","aria-label","Default select example",1,"form-select",2,"height","50px !important"],["value","ward?.name",4,"ngFor","ngForOf"],[2,"width","100%","margin-top","10px","margin-bottom","10px","display","flex","justify-content","end"],["type","submit",2,"height","50px","background-color","#1f6e50","border","none","border-radius","5px","color","white","width","20%"],[3,"value"],["value","subcounty?.name"],["value","ward?.name"]],template:function(a,t){1&a&&(e.nrm(0,"app-pagetitle",0),e.j41(1,"div")(2,"div",1)(3,"div",2)(4,"form",3)(5,"div",4)(6,"div",5)(7,"label",6),e.EFF(8,"Start Date"),e.k0s(),e.nrm(9,"input",7),e.k0s(),e.j41(10,"div",5)(11,"label",6),e.EFF(12,"End Date"),e.k0s(),e.nrm(13,"input",8),e.k0s(),e.j41(14,"div",5)(15,"label",9),e.EFF(16,"County"),e.k0s(),e.j41(17,"p-multiSelect",10),e.bIt("ngModelChange",function(i){return t.selectedCounty=i})("onChange",function(i){return t.filter(i.value)}),e.k0s()(),e.j41(18,"div",5)(19,"label",9),e.EFF(20,"Sub County"),e.k0s(),e.j41(21,"p-multiSelect",11),e.bIt("ngModelChange",function(i){return t.selectedSubcounty=i})("onChange",function(i){return t.filterWards(i.value)}),e.k0s()(),e.j41(22,"div",5)(23,"label",9),e.EFF(24,"Ward"),e.k0s(),e.j41(25,"p-multiSelect",12),e.bIt("ngModelChange",function(i){return t.selectedWard=i}),e.k0s()(),e.j41(26,"div",5)(27,"label",9),e.EFF(28,"Group"),e.k0s(),e.j41(29,"p-multiSelect",13),e.bIt("ngModelChange",function(i){return t.selectedGroup=i}),e.k0s()()()(),e.j41(30,"div",14)(31,"p",15),e.bIt("click",function(){return t.exportSelectedMembers()}),e.qSk(),e.j41(32,"svg",16),e.nrm(33,"path",17)(34,"path",18),e.k0s(),e.EFF(35," Export selected Tot's "),e.k0s(),e.joV(),e.j41(36,"p",19),e.bIt("click",function(){return t.exportEntireMembersReport()}),e.qSk(),e.j41(37,"svg",16),e.nrm(38,"path",17)(39,"path",18),e.k0s(),e.EFF(40," Export All Tots's "),e.k0s()()()()(),e.joV(),e.j41(41,"div",20)(42,"div",21)(43,"div",22)(44,"input",23),e.bIt("change",function(i){return t.selectAll(i)}),e.k0s()(),e.j41(45,"div",24),e.EFF(46,"Id"),e.k0s(),e.j41(47,"div",25),e.EFF(48,"Name"),e.k0s(),e.j41(49,"div",25),e.EFF(50,"Mobile"),e.k0s(),e.j41(51,"div",25),e.EFF(52,"Gender"),e.k0s(),e.j41(53,"div",25),e.EFF(54,"Date of Birth"),e.k0s(),e.j41(55,"div",25),e.EFF(56,"Status"),e.k0s(),e.j41(57,"div",25),e.EFF(58,"County"),e.k0s(),e.j41(59,"div",25),e.EFF(60,"Sub County"),e.k0s(),e.j41(61,"div",25),e.EFF(62,"ID Number"),e.k0s(),e.j41(63,"div",25),e.EFF(64,"Actions"),e.k0s()(),e.DNE(65,W,31,11,"div",26),e.j41(66,"div",27)(67,"p"),e.EFF(68),e.k0s(),e.j41(69,"div")(70,"ngb-pagination",28),e.bIt("pageChange",function(i){return t.setPage(i)})("pageChange",function(i){return t.dataParams.page_num=i}),e.k0s()()()()),2&a&&(e.Y8G("breadcrumbItems",t.breadCrumbItems),e.R7$(4),e.Y8G("formGroup",t.searchForm),e.R7$(13),e.Y8G("options",t.counties)("ngModel",t.selectedCounty),e.R7$(4),e.Y8G("options",t.subcountyOptions)("ngModel",t.selectedSubcounty),e.R7$(4),e.Y8G("options",t.wardOptions)("ngModel",t.selectedWard),e.R7$(4),e.Y8G("options",t.myGroups)("ngModel",t.selectedGroup),e.R7$(36),e.Y8G("ngForOf",t.rows),e.R7$(3),e.E5c(" Showing ",1===t.dataParams.page_size?1:t.dataParams.page_num*t.dataParams.page_size-10," to ",t.dataParams.page_num*t.dataParams.page_size," of ",200," entries "),e.R7$(2),e.Y8G("collectionSize",t.totalCounts)("page",t.dataParams.page_num)("maxSize",5)("boundaryLinks",!0))},dependencies:[v.G,F.T,o.X1,o.qT,o.xH,o.y7,o.me,o.wz,o.BC,o.cb,o.j4,o.JD,f.MQ,c.Kj,o.YN,p.MD,p.Sq,p.PV,g.s5,b.iV,b.KF,C.D]})}return n})()}];let H=(()=>{class n{static#e=this.\u0275fac=function(a){return new(a||n)};static#t=this.\u0275mod=e.$C({type:n});static#a=this.\u0275inj=e.G2t({imports:[_.iI.forChild(A),_.iI]})}return n})(),Z=(()=>{class n{static#e=this.\u0275fac=function(a){return new(a||n)};static#t=this.\u0275mod=e.$C({type:n});static#a=this.\u0275inj=e.G2t({imports:[p.MD,H]})}return n})()}}]);