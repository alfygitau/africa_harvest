"use strict";(self.webpackChunkminia=self.webpackChunkminia||[]).push([[891],{4891:(A,x,d)=>{d.r(x),d.d(x,{UsersModule:()=>M});var p=d(177),u=d(8498),v=d(467),f=d(3887),F=d(3335),s=d(9417),c=d(2150),w=d(3682),e=d(4438),h=d(9700),k=d(5794),g=d(8548);function j(o,l){if(1&o){const t=e.RV6();e.j41(0,"div")(1,"div",37)(2,"h5",38),e.EFF(3," Edit user "),e.k0s(),e.j41(4,"button",39),e.bIt("click",function(){const n=e.eBV(t).$implicit;return e.Njj(n.dismiss("Cross click"))}),e.k0s()(),e.j41(5,"div",40)(6,"form",41),e.bIt("ngSubmit",function(i){e.eBV(t);const n=e.XpG(2);return e.Njj(n.handleSubmit(i))}),e.j41(7,"div",42)(8,"div",43)(9,"div",44)(10,"label",45),e.EFF(11,"First Name"),e.k0s(),e.nrm(12,"input",46),e.k0s(),e.j41(13,"div",44)(14,"label",47),e.EFF(15,"Last Name"),e.k0s(),e.nrm(16,"input",48),e.k0s(),e.j41(17,"div",44)(18,"label",49),e.EFF(19,"Username"),e.k0s(),e.nrm(20,"input",50),e.k0s(),e.j41(21,"div",44)(22,"label",51),e.EFF(23,"Email"),e.k0s(),e.nrm(24,"input",52),e.k0s(),e.j41(25,"div",44)(26,"label",53),e.EFF(27,"ID Number"),e.k0s(),e.nrm(28,"input",54),e.k0s(),e.j41(29,"div",44)(30,"label",55),e.EFF(31,"Date of Birth"),e.k0s(),e.nrm(32,"input",56),e.k0s()(),e.j41(33,"div",43)(34,"div",44)(35,"label",57),e.EFF(36,"Phone Number"),e.k0s(),e.nrm(37,"input",58),e.k0s(),e.j41(38,"div",44)(39,"label",59),e.EFF(40,"Gender"),e.k0s(),e.j41(41,"select",60)(42,"option",61),e.EFF(43,"Male"),e.k0s(),e.j41(44,"option",62),e.EFF(45,"Female"),e.k0s()()(),e.j41(46,"div",44)(47,"label",63),e.EFF(48,"Role"),e.k0s(),e.j41(49,"select",64)(50,"option",65),e.EFF(51,"Admin"),e.k0s(),e.j41(52,"option",66),e.EFF(53,"Tot"),e.k0s()()()()(),e.j41(54,"div",67)(55,"button",68),e.EFF(56," Edit User "),e.k0s()()()()()}if(2&o){const t=e.XpG(2);e.R7$(6),e.Y8G("formGroup",t.updateUserForm)}}function C(o,l){if(1&o){const t=e.RV6();e.j41(0,"div",23)(1,"div",24),e.EFF(2),e.k0s(),e.j41(3,"div",25),e.EFF(4),e.k0s(),e.j41(5,"div",26),e.EFF(6),e.k0s(),e.j41(7,"div",24),e.EFF(8),e.k0s(),e.j41(9,"div",27),e.EFF(10),e.k0s(),e.j41(11,"div",24),e.EFF(12),e.k0s(),e.j41(13,"div",24)(14,"p",28),e.EFF(15),e.k0s()(),e.j41(16,"div",24),e.EFF(17),e.k0s(),e.j41(18,"div",24),e.EFF(19),e.k0s(),e.j41(20,"div",29),e.qSk(),e.j41(21,"svg",30),e.bIt("click",function(){const n=e.eBV(t).$implicit,a=e.XpG();return e.Njj(a.navigateToProfile(n))}),e.j41(22,"g",31),e.nrm(23,"circle",32)(24,"path",33),e.k0s()(),e.j41(25,"svg",34),e.bIt("click",function(){const n=e.eBV(t).$implicit,a=e.sdS(29),b=e.XpG();return e.Njj(b.centerModal(a,n))}),e.nrm(26,"path",35),e.k0s(),e.joV(),e.j41(27,"div"),e.DNE(28,j,57,1,"ng-template",null,36,e.C5r),e.k0s()()()}if(2&o){const t=l.$implicit;e.R7$(2),e.SpI(" ",null==t?null:t.firstName," "),e.R7$(2),e.SpI(" ",null==t?null:t.lastName," "),e.R7$(2),e.SpI(" ",null==t?null:t.email," "),e.R7$(2),e.SpI(" ",null==t?null:t.idNumber," "),e.R7$(2),e.SpI(" ",1===(null==t?null:t.userTypeId)?"Admin":"Tot"," "),e.R7$(2),e.SpI(" ",null==t?null:t.countyTitle," "),e.R7$(3),e.SpI(" ",null==t?null:t.subcountyTitle," "),e.R7$(2),e.SpI(" ",null==t?null:t.gender," "),e.R7$(2),e.SpI(" ",null==t?null:t.dob," ")}}let y=(()=>{class o{constructor(t,r,i,n,a){this.fb=t,this.usersService=r,this.router=i,this.modalService=n,this.toastr=a,this.users=[],this.size=1,this.limit=10,this.totalUsers=0,this.selectedExportOption="CSV",this.searchText="",this.roles=null,this.counties=[],this.subCounties=[],this.wards=[],this.updateUserForm=this.fb.group({firstName:["",s.k0.required],lastName:["",s.k0.required],username:["",s.k0.required],email:["",[s.k0.required,s.k0.email]],idNumber:["",s.k0.required],dateOfBirth:[this.formatDate(new Date),s.k0.required],phoneNumber:["",s.k0.required],gender:["",s.k0.required],countyTitle:["",s.k0.required],subcountyTitle:["",s.k0.required],wardTitle:["",s.k0.required],role:["",s.k0.required]})}formatDate(t){let r=new Date(t),i=""+(r.getMonth()+1),n=""+r.getDate(),a=r.getFullYear();return i.length<2&&(i="0"+i),n.length<2&&(n="0"+n),[a,i,n].join("-")}ngOnInit(){this.breadCrumbItems=[{label:"Users"},{label:"Userslist",active:!0}],this.fetchUsers();const t=localStorage.getItem("roles");this.roles=t?JSON.parse(t):""}onParamsChange(){this.fetchUsers()}centerModal(t,r){this.selectedUser=r,this.updateUserForm.patchValue({firstName:r.firstName,lastName:r.lastName,username:r.username,email:r.email,idNumber:r.idNumber,dateOfBirth:this.formatDate(new Date(r.dob)),phoneNumber:r.msisdn,gender:r.gender,countyTitle:r.countyTitle,subcountyTitle:r.subcountyTitle,wardTitle:r?.wardTitle,role:r?.userTypeId}),this.modalService.open(t,{centered:!0,windowClass:"modal-user-holder",size:"lg"}),this.getCounties();const i=this.updateUserForm.get("county"),n=this.updateUserForm.get("subcounty");i&&i.valueChanges.subscribe(a=>{this.subCounties=this.usersService.fetchSubCounties(Number(a))}),n&&n.valueChanges.subscribe(a=>{this.wards=this.usersService.getWards(Number(a))})}findUser(){}navigateToProfile(t){this.router.navigate(["/users",t?.msisdn])}navigateToAddUser(){this.router.navigate(["/users/add-user"])}handleSubmit(t){var r=this;return(0,v.A)(function*(){if(t.preventDefault(),r.roles?.includes("Admin")||r.roles?.includes("CIO")){if(r.updateUserForm.valid){const i={firstName:r.updateUserForm.value.firstName,lastName:r.updateUserForm.value.lastName,gender:r.updateUserForm.value.gender,idNumber:r.updateUserForm.value.idNumber,dob:r.updateUserForm.value.dateOfBirth,email:r.updateUserForm.value.email,msisdn:r.updateUserForm.value.phoneNumber,username:r.updateUserForm.value.username,userTypeId:r.updateUserForm.value.role};yield r.usersService.updateUser(r.selectedUser?.username,i).subscribe(n=>{r.updateUserForm.reset(),r.toastr.success("Success","User updated successfully")},n=>{console.error("Error:",n),r.toastr.error("Error","Failed to update user")})}}else r.toastr.error("You do not have permission to update a user")})()}fetchUsers(){this.usersService.getUsers(this.size,this.limit).subscribe(t=>{this.users=t,this.totalUsers=650},t=>{console.error("Error fetching users:",t)})}onPageChange(t){this.size=t,this.fetchUsers()}filterUsers(){return this.searchText.trim()?this.users.filter(t=>t?.firstName.toLowerCase().includes(this.searchText.toLowerCase())||t?.lastName.toLowerCase().includes(this.searchText.toLowerCase())||t?.email.toLowerCase().includes(this.searchText.toLowerCase())):this.users}getCounties(){this.counties=this.usersService.fetchCounties()}fetchSubcounties(t){return this.usersService.fetchSubCounties(t)}fetchWards(t){return this.usersService.getWards(t)}static#e=this.\u0275fac=function(r){return new(r||o)(e.rXU(s.ok),e.rXU(h.g),e.rXU(u.Ix),e.rXU(c.Bq),e.rXU(k.tw))};static#t=this.\u0275cmp=e.VBU({type:o,selectors:[["app-users"]],standalone:!0,features:[e.aNF],decls:50,vars:10,consts:[["title","Admin users",3,"breadcrumbItems"],[2,"background-color","white","padding-left","10px","padding-right","10px","padding-top","10px","padding-bottom","10px"],[2,"width","100%","height","45px","display","flex","align-items","center","justify-content","space-between","margin-bottom","20px"],[2,"font-weight","bold"],[2,"display","flex","align-items","center","gap","10px","height","100%"],[2,"background-color","#fbb43c","color","white","height","40px","width","50px","border-radius","5px","border","none","display","flex","align-items","center","justify-content","center"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","viewBox","0 0 24 24"],["fill","#fff","d","M7 9V7h14v2zm0 4v-2h14v2zm0 4v-2h14v2zM4 9q-.425 0-.712-.288T3 8t.288-.712T4 7t.713.288T5 8t-.288.713T4 9m0 4q-.425 0-.712-.288T3 12t.288-.712T4 11t.713.288T5 12t-.288.713T4 13m0 4q-.425 0-.712-.288T3 16t.288-.712T4 15t.713.288T5 16t-.288.713T4 17"],[2,"background-color","#e9e9ef","color","white","height","40px","width","50px","border-radius","5px","border","none","display","flex","align-items","center","justify-content","center"],["fill","none","stroke","#000","stroke-linecap","round","stroke-linejoin","round","d","M5.5 9.5v-3a1 1 0 0 1 1-1h3a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-3a1 1 0 0 1-1-1m8 0v-3a1 1 0 0 1 1-1h3a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-3a1 1 0 0 1-1-1m0 8v-3a1 1 0 0 1 1-1h3a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-3a1 1 0 0 1-1-1m-8 0v-3a1 1 0 0 1 1-1h3a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-3a1 1 0 0 1-1-1"],[2,"background-color","#1f6e50","display","flex","align-items","center","justify-content","center","border-radius","5px","height","40px","width","120px","gap","10px","border","none","cursor","pointer","color","white",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","1em","height","1em","viewBox","0 0 24 24"],["fill","none"],["d","M24 0v24H0V0zM12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035c-.01-.004-.019-.001-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427c-.002-.01-.009-.017-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093c.012.004.023 0 .029-.008l.004-.014l-.034-.614c-.003-.012-.01-.02-.02-.022m-.715.002a.023.023 0 0 0-.027.006l-.006.014l-.034.614c0 .012.007.02.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"],["fill","#fff","d","M10.5 20a1.5 1.5 0 0 0 3 0v-6.5H20a1.5 1.5 0 0 0 0-3h-6.5V4a1.5 1.5 0 0 0-3 0v6.5H4a1.5 1.5 0 0 0 0 3h6.5z"],[2,"width","100%"],[1,"d-flex","align-items-center",2,"width","100%","height","40px","border-bottom","1px solid #e9e9ef","font-weight","bold"],[2,"height","100%","width","10%"],[2,"height","100%","width","15%"],[2,"height","100%","width","5%"],["class","d-flex flex-row align-items-center","style","height: 48px; border-bottom: 1px solid #e9e9ef",4,"ngFor","ngForOf"],[2,"display","flex","align-items","center","justify-content","space-between","width","100%","height","80px","margin-top","20px"],[3,"collectionSize","page","maxSize","boundaryLinks","pageChange"],[1,"d-flex","flex-row","align-items-center",2,"height","48px","border-bottom","1px solid #e9e9ef"],[2,"height","100%","width","10%","display","flex","align-items","center","justify-content","start","font-size","12px"],[2,"height","100%","font-size","12px","width","10%","display","flex","align-items","center"],[2,"height","100%","width","15%","display","flex","align-items","center","justify-content","start","font-size","12px"],[2,"height","100%","width","5%","display","flex","align-items","center","justify-content","start","font-size","12px"],[1,"truncate",2,"width","85%"],[2,"height","100%","width","10%","display","flex","align-items","center","justify-content","start"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24",2,"cursor","pointer","margin-right","10px",3,"click"],["fill","none","stroke","#000"],["cx","12","cy","12","r","3.5"],["d","M20.188 10.934c.388.472.582.707.582 1.066c0 .359-.194.594-.582 1.066C18.768 14.79 15.636 18 12 18c-3.636 0-6.768-3.21-8.188-4.934c-.388-.472-.582-.707-.582-1.066c0-.359.194-.594.582-1.066C5.232 9.21 8.364 6 12 6c3.636 0 6.768 3.21 8.188 4.934Z"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24",2,"cursor","pointer",3,"click"],["fill","none","stroke","#000","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","m14.304 4.844l2.852 2.852M7 7H4a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h11a1 1 0 0 0 1-1v-4.5m2.409-9.91a2.017 2.017 0 0 1 0 2.853l-6.844 6.844L8 14l.713-3.565l6.844-6.844a2.015 2.015 0 0 1 2.852 0Z"],["userModal",""],[1,"modal-header"],[1,"modal-title","mt-0",2,"margin-left","10px"],["type","button","aria-hidden","true",1,"btn-close",3,"click"],[1,"modal-body"],[2,"width","100%",3,"formGroup","ngSubmit"],[2,"width","100%","display","flex","gap","20px","padding-left","10px","padding-right","10px"],[1,"d-flex","flex-column",2,"width","50%"],[1,"d-flex","flex-column",2,"margin-bottom","10px"],["for","firstname",2,"margin-bottom","0px"],["type","text","formControlName","firstName","id","firstname",2,"height","50px","width","100%","padding-left","10px","padding-right","10px","border","1px solid #e9e9ef","border-radius","5px"],["for","lastname",2,"margin-bottom","0px"],["type","text","formControlName","lastName","id","lastname",2,"height","50px","width","100%","padding-left","10px","padding-right","10px","border","1px solid #e9e9ef","border-radius","5px"],["for","username",2,"margin-bottom","0px"],["type","text","formControlName","username","id","username",2,"height","50px","width","100%","padding-left","10px","padding-right","10px","border","1px solid #e9e9ef","border-radius","5px"],["for","email",2,"margin-bottom","0px"],["type","text","formControlName","email","id","email",2,"height","50px","width","100%","padding-left","10px","padding-right","10px","border","1px solid #e9e9ef","border-radius","5px"],["for","idnumber",2,"margin-bottom","0px"],["type","text","formControlName","idNumber","id","idnumber",2,"height","50px","width","100%","padding-left","10px","padding-right","10px","border","1px solid #e9e9ef","border-radius","5px"],["for","dateOfBirth",2,"margin-bottom","0px"],["type","date","formControlName","dateOfBirth","id","dateOfBirth",2,"height","50px","width","100%","padding-left","10px","padding-right","10px","border","1px solid #e9e9ef","border-radius","5px"],["for","phonenumber",2,"margin-bottom","0px"],["type","text","formControlName","phoneNumber","id","phonenumber",2,"height","50px","width","100%","padding-left","10px","padding-right","10px","border","1px solid #e9e9ef","border-radius","5px"],["for","gender",2,"margin-bottom","0px"],["formControlName","gender","id","gender","aria-label","Default select example",1,"form-select",2,"height","50px !important"],["value","male"],["value","female"],["for","role",2,"margin-bottom","0px"],["formControlName","role","id","role","aria-label","Default select example",1,"form-select",2,"height","50px !important"],["value","1"],["value","2"],[2,"width","100%","margin-left","10px"],["type","submit",2,"height","50px","width","47.5%","margin-top","10px","margin-bottom","10px","background-color","#1f6e50","border","none","border-radius","5px","color","white"]],template:function(r,i){1&r&&(e.j41(0,"div"),e.nrm(1,"app-pagetitle",0),e.j41(2,"div",1)(3,"div",2)(4,"p",3),e.EFF(5," Users List "),e.j41(6,"span"),e.EFF(7),e.k0s()(),e.j41(8,"div",4)(9,"div",5),e.qSk(),e.j41(10,"svg",6),e.nrm(11,"path",7),e.k0s()(),e.joV(),e.j41(12,"div",8),e.qSk(),e.j41(13,"svg",6),e.nrm(14,"path",9),e.k0s()(),e.joV(),e.j41(15,"button",10),e.bIt("click",function(){return i.navigateToAddUser()}),e.qSk(),e.j41(16,"svg",11)(17,"g",12),e.nrm(18,"path",13)(19,"path",14),e.k0s()(),e.EFF(20," Add "),e.k0s()()(),e.joV(),e.j41(21,"div",15)(22,"div",16)(23,"div",17),e.EFF(24,"First Name"),e.k0s(),e.j41(25,"div",17),e.EFF(26,"Last Name"),e.k0s(),e.j41(27,"div",18),e.EFF(28,"Email"),e.k0s(),e.j41(29,"div",17),e.EFF(30,"Id Number"),e.k0s(),e.j41(31,"div",19),e.EFF(32,"Role"),e.k0s(),e.j41(33,"div",17),e.EFF(34,"County"),e.k0s(),e.j41(35,"div",17),e.EFF(36,"Sub County"),e.k0s(),e.j41(37,"div",17),e.EFF(38,"Gender"),e.k0s(),e.j41(39,"div",17),e.EFF(40,"Date of Birth"),e.k0s(),e.j41(41,"div",17),e.EFF(42,"Actions"),e.k0s()(),e.j41(43,"div"),e.DNE(44,C,30,9,"div",20),e.k0s()(),e.j41(45,"div",21)(46,"p"),e.EFF(47),e.k0s(),e.j41(48,"div")(49,"ngb-pagination",22),e.bIt("pageChange",function(a){return i.onPageChange(a)})("pageChange",function(a){return i.size=a}),e.k0s()()()()()),2&r&&(e.R7$(1),e.Y8G("breadcrumbItems",i.breadCrumbItems),e.R7$(6),e.SpI("(",i.users.length,")"),e.R7$(37),e.Y8G("ngForOf",i.users),e.R7$(3),e.E5c(" Showing ",1===i.size?1:i.limit*i.size-10," to ",i.limit*i.size," of ",i.totalUsers," entries "),e.R7$(2),e.Y8G("collectionSize",50)("page",i.size)("maxSize",5)("boundaryLinks",!0))},dependencies:[f.G,g.T,c.UN,c.s5,p.MD,p.Sq,F.x,s.YN,s.qT,s.xH,s.y7,s.me,s.wz,s.BC,s.cb,s.X1,s.j4,s.JD,w.MQ],styles:[".modal-user-holder[_ngcontent-%COMP%]   .modal-dialog[_ngcontent-%COMP%]{min-width:800px!important}.truncate[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}"]})}return o})();const E=["userModal"];function N(o,l){if(1&o&&(e.j41(0,"option",43),e.EFF(1),e.k0s()),2&o){const t=l.$implicit;e.Y8G("value",t.userTypeId),e.R7$(1),e.SpI(" ",t.title," ")}}function _(o,l){if(1&o&&(e.j41(0,"option",43),e.EFF(1),e.k0s()),2&o){const t=l.$implicit;e.Y8G("value",t.county_id),e.R7$(1),e.SpI(" ",t.name," ")}}function U(o,l){if(1&o&&(e.j41(0,"option",43),e.EFF(1),e.k0s()),2&o){const t=l.$implicit;e.Y8G("value",t.subCountyId),e.R7$(1),e.SpI(" ",t.name," ")}}function T(o,l){if(1&o&&(e.j41(0,"option",43),e.EFF(1),e.k0s()),2&o){const t=l.$implicit;e.Y8G("value",t.wardId),e.R7$(1),e.SpI(" ",t.name," ")}}function S(o,l){if(1&o&&(e.j41(0,"option",43),e.EFF(1),e.k0s()),2&o){const t=l.$implicit;e.Y8G("value",t.roleId),e.R7$(1),e.SpI(" ",t.title," ")}}function I(o,l){if(1&o){const t=e.RV6();e.j41(0,"div",44)(1,"form",45)(2,"p"),e.EFF(3,"Select role"),e.k0s(),e.j41(4,"select",46)(5,"option",47),e.EFF(6,"Select user role"),e.k0s(),e.DNE(7,S,2,2,"option",27),e.k0s()(),e.j41(8,"div",48)(9,"button",49),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.userRoleCreate())}),e.EFF(10," Add User "),e.k0s()()()}if(2&o){const t=e.XpG();e.R7$(1),e.Y8G("formGroup",t.userForm),e.R7$(6),e.Y8G("ngForOf",t.allRoles)}}function $(o,l){if(1&o&&(e.j41(0,"div",21)(1,"div",22)(2,"p",16),e.EFF(3,"Biography"),e.k0s(),e.j41(4,"div",23)(5,"div",24)(6,"p",25),e.EFF(7,"First Name:"),e.k0s(),e.j41(8,"p",25),e.EFF(9),e.k0s()(),e.j41(10,"div",24)(11,"p",25),e.EFF(12,"Last Name:"),e.k0s(),e.j41(13,"p",25),e.EFF(14),e.k0s()(),e.j41(15,"div",24)(16,"p",25),e.EFF(17,"Gender:"),e.k0s(),e.j41(18,"p",25),e.EFF(19),e.k0s()(),e.j41(20,"div",24)(21,"p",25),e.EFF(22,"ID Number:"),e.k0s(),e.j41(23,"p",25),e.EFF(24),e.k0s()(),e.j41(25,"div",24)(26,"p",25),e.EFF(27,"Date of Birth:"),e.k0s(),e.j41(28,"p",25),e.EFF(29),e.k0s()(),e.j41(30,"div",24)(31,"p",25),e.EFF(32,"Phone Number:"),e.k0s(),e.j41(33,"p",25),e.EFF(34),e.k0s()(),e.j41(35,"div",24)(36,"p",25),e.EFF(37,"Status"),e.k0s(),e.j41(38,"p",25),e.EFF(39,"Active"),e.k0s()(),e.j41(40,"div",24)(41,"p",25),e.EFF(42,"Role"),e.k0s(),e.j41(43,"p",25),e.EFF(44),e.k0s()()()(),e.j41(45,"div",22)(46,"p",16),e.EFF(47,"Address/Location"),e.k0s(),e.j41(48,"div",23)(49,"div",24)(50,"p",25),e.EFF(51,"County"),e.k0s(),e.j41(52,"p",25),e.EFF(53),e.k0s()(),e.j41(54,"div",24)(55,"p",25),e.EFF(56,"Sub County:"),e.k0s(),e.j41(57,"p",25),e.EFF(58),e.k0s()(),e.j41(59,"div",24)(60,"p",25),e.EFF(61,"Ward"),e.k0s(),e.j41(62,"p",25),e.EFF(63),e.k0s()()()()()),2&o){const t=e.XpG();e.R7$(9),e.JRh(t.user.firstName),e.R7$(5),e.JRh(t.user.lastName),e.R7$(5),e.JRh(t.user.gender),e.R7$(5),e.JRh(t.user.idNumber),e.R7$(5),e.JRh(t.user.dob),e.R7$(5),e.JRh(t.user.msisdn),e.R7$(10),e.SpI(" ",1===t.user.userTypeId?"Admin":"Tot"," "),e.R7$(9),e.SpI(" ",t.user.countyTitle||"N/A"," "),e.R7$(5),e.SpI(" ",t.user.subcountyTitle||"N/A"," "),e.R7$(5),e.JRh(t.user.wardTitle||"N/A")}}function D(o,l){1&o&&(e.j41(0,"div")(1,"p"),e.EFF(2,"No record of user metadata"),e.k0s()())}const G=[{path:"userlist",component:y},{path:"add-user",component:(()=>{class o{constructor(t,r,i,n,a){this.fb=t,this.usersService=r,this.toastr=i,this.modalService=n,this.router=a,this.isCIO=!1,this.isDisabled=!0,this.allRoles=[],this.userTypes=[],this.userId="",this.selectedRole=null,this.counties=[],this.subCounties=[],this.wards=[],this.roles=null,this.cio_county=null,this.cio_county_id=null,this.userForm=this.fb.group({firstName:["",s.k0.required],lastName:["",s.k0.required],username:["",s.k0.required],email:["",[s.k0.required,s.k0.email]],idNumber:["",s.k0.required],dateOfBirth:[this.formatDate(new Date),s.k0.required],phoneNumber:["",s.k0.required],role:["",s.k0.required],userType:["",s.k0.required],gender:["",s.k0.required],county:["",s.k0.required],subcounty:["",s.k0.required],ward:["",s.k0.required],password:["",s.k0.required],confirmPassword:["",s.k0.required]})}formatDate(t){let r=new Date(t),i=""+(r.getMonth()+1),n=""+r.getDate(),a=r.getFullYear();return i.length<2&&(i="0"+i),n.length<2&&(n="0"+n),[a,i,n].join("-")}ngOnInit(){this.breadCrumbItems=[{label:"Users"},{label:"Add user",active:!0}],this.getCounties(),this.fetchAllRoles(),this.fetchAllUserTypes();const t=this.userForm.get("county"),r=this.userForm.get("subcounty");t&&t.valueChanges.subscribe(m=>{this.subCounties=this.usersService.fetchSubCounties(Number(m))}),r&&r.valueChanges.subscribe(m=>{this.wards=this.usersService.getWards(Number(m))});const i=localStorage.getItem("roles");this.roles=i?JSON.parse(i):"";const n=localStorage.getItem("user_info");let a=n?JSON.parse(n):"";this.cio_county=a?.countyTitle;let b=this.counties.find(m=>m?.name===this.cio_county.toUpperCase());this.cio_county_id=b?.county_id,this.isCIO=!!this.roles&&this.roles.includes("CIO"),this.userForm.patchValue({firstName:"",lastName:"",username:"",email:"",idNumber:"",dateOfBirth:this.formatDate(new Date),phoneNumber:"",role:"",gender:"",county:this.cio_county_id,subcounty:"",ward:"",password:"",confirmPassword:""})}handleSubmit(t){var r=this;return(0,v.A)(function*(){if(t.preventDefault(),r.roles?.includes("Admin")||r.roles?.includes("CIO"))if(r.userForm.value.password===r.userForm.value.confirmPassword){const i={firstName:r.userForm.value.firstName,lastName:r.userForm.value.lastName,gender:r.userForm.value.gender,idNumber:r.userForm.value.idNumber,dob:r.userForm.value.dateOfBirth,email:r.userForm.value.email,msisdn:r.userForm.value.phoneNumber,username:r.userForm.value.username,password:r.userForm.value.password,userTypeId:Number(r.userForm.value.userType),wardId:Number(r.userForm.value.ward)};yield r.usersService.createUser(i).subscribe(n=>{201===n?.statusCode?(r.userId=n.message.ID,r.modalService.open(r.userModal,{centered:!0,windowClass:"modal-user-holder",size:"md"})):r.toastr.error("Error",n.message)},n=>{console.error("Error:",n),r.toastr.error("Error","Failed to add user")})}else r.toastr.error("Error","Passwords do not match");else r.toastr.error("You have no permission to create users","Error")})()}getCounties(){this.counties=this.usersService.fetchCounties()}fetchAllRoles(){this.usersService.getAllRoles().subscribe(t=>{this.allRoles=t.message,this.allRoles.length>0&&this.userForm.patchValue({role:this.allRoles[0].roleId})})}fetchAllUserTypes(){this.usersService.getUserTypes().subscribe(t=>{this.userTypes=t.message})}userRoleCreate(){let t={userId:this.userId,roleId:Number(this.userForm.value.role)};this.usersService.finalizeUserCreation(t).subscribe(r=>{(201===r.statusCode||200===r.statusCode)&&(this.modalService.dismissAll(),this.toastr.success("Success","User added successfully"),this.router.navigate(["/users/userlist"]))})}static#e=this.\u0275fac=function(r){return new(r||o)(e.rXU(s.ok),e.rXU(h.g),e.rXU(k.tw),e.rXU(c.Bq),e.rXU(u.Ix))};static#t=this.\u0275cmp=e.VBU({type:o,selectors:[["app-add-user"]],viewQuery:function(r,i){if(1&r&&e.GBs(E,5),2&r){let n;e.mGM(n=e.lsd())&&(i.userModal=n.first)}},standalone:!0,features:[e.aNF],decls:87,vars:7,consts:[["title","Add User / Tot",3,"breadcrumbItems"],[2,"border","1px solid #e9e9ef","/* border-radius","10px","*/\n      padding-left","20px","padding-right","20px","padding-top","10px","padding-bottom","10px","width","100%","height","100%","background-color","white"],[2,"width","100%",3,"formGroup","ngSubmit"],[2,"width","100%","display","flex","gap","20px"],[1,"d-flex","flex-column",2,"width","50%"],[1,"d-flex","flex-column",2,"margin-bottom","10px"],["for","firstname",2,"margin-bottom","0px"],["type","text","formControlName","firstName","id","firstname","placeholder","Enter First Name",2,"height","50px","width","100%","padding-left","10px","padding-right","10px","border","1px solid #e9e9ef","border-radius","5px"],["for","lastname",2,"margin-bottom","0px"],["type","text","formControlName","lastName","id","lastname","placeholder","Enter Last Name",2,"height","50px","width","100%","padding-left","10px","padding-right","10px","border","1px solid #e9e9ef","border-radius","5px"],["for","username",2,"margin-bottom","0px"],["type","text","formControlName","username","id","username","placeholder","Enter Username",2,"height","50px","width","100%","padding-left","10px","padding-right","10px","border","1px solid #e9e9ef","border-radius","5px"],["for","email",2,"margin-bottom","0px"],["type","text","formControlName","email","id","email","placeholder","Enter email",2,"height","50px","width","100%","padding-left","10px","padding-right","10px","border","1px solid #e9e9ef","border-radius","5px"],["for","idnumber",2,"margin-bottom","0px"],["type","text","formControlName","idNumber","id","idnumber","placeholder","Enter Id Number",2,"height","50px","width","100%","padding-left","10px","padding-right","10px","border","1px solid #e9e9ef","border-radius","5px"],["for","dateOfBirth",2,"margin-bottom","0px"],["type","date","formControlName","dateOfBirth","id","dateOfBirth","placeholder","Enter date of birth",2,"height","50px","width","100%","padding-left","10px","padding-right","10px","border","1px solid #e9e9ef","border-radius","5px"],["for","phonenumber",2,"margin-bottom","0px"],["type","text","formControlName","phoneNumber","id","phonenumber","placeholder","Enter phone number",2,"height","50px","width","100%","padding-left","10px","padding-right","10px","border","1px solid #e9e9ef","border-radius","5px"],["for","gender",2,"margin-bottom","0px"],["formControlName","gender","id","gender","placeholder","Select gender","aria-label","Default select example",1,"form-select",2,"height","50px !important"],["value",""],["value","male"],["value","female"],["for","role",2,"margin-bottom","0px"],["formControlName","userType","id","usertype","placeholder","Select a user type","aria-label","Default select example",1,"form-select",2,"height","50px !important"],[3,"value",4,"ngFor","ngForOf"],[2,"display","flex","align-items","center","justify-content","space-between"],[1,"d-flex","flex-column",2,"margin-bottom","10px","width","30%"],["for","county",2,"margin-bottom","0px"],["formControlName","county","placeholder","Enter county","id","county","aria-label","Default select example",1,"form-select",2,"height","50px !important",3,"disabled"],["for","subcounty",2,"margin-bottom","0px"],["formControlName","subcounty","id","subcounty","aria-label","Default select example",1,"form-select",2,"height","50px !important"],["for","ward",2,"margin-bottom","0px"],["formControlName","ward","id","ward","aria-label","Default select example",1,"form-select",2,"height","50px !important"],["for","password",2,"margin-bottom","0px"],["type","password","formControlName","password","id","password","placeholder","Enter your password",2,"height","50px","width","100%","padding-left","10px","padding-right","10px","border","1px solid #e9e9ef","border-radius","5px"],["for","confirm_password",2,"margin-bottom","0px"],["type","password","formControlName","confirmPassword","id","confirm_password","placeholder","Confirm your password",2,"height","50px","width","100%","padding-left","10px","padding-right","10px","border","1px solid #e9e9ef","border-radius","5px"],[2,"width","100%","margin-top","10px","margin-bottom","10px","display","flex","justify-content","start"],["type","submit",2,"height","50px","background-color","#1f6e50","border","none","border-radius","5px","color","white","width","20%"],["userModal",""],[3,"value"],[1,"modal-body","d-flex","flex-column","justify-content-center","align-items-center",2,"height","300px"],[2,"width","100%",3,"formGroup"],["name","role","id","role","formControlName","role",1,"form-select"],["selected","","value",""],[2,"margin-top","20px","width","100%","margin-bottom","20px"],[1,"bg-gray",2,"height","50px","border-radius","10px","width","100%","border","none",3,"click"]],template:function(r,i){1&r&&(e.j41(0,"div"),e.nrm(1,"app-pagetitle",0),e.j41(2,"div",1)(3,"form",2),e.bIt("ngSubmit",function(a){return i.handleSubmit(a)}),e.j41(4,"div",3)(5,"div",4)(6,"div",5)(7,"label",6),e.EFF(8,"First Name"),e.k0s(),e.nrm(9,"input",7),e.k0s(),e.j41(10,"div",5)(11,"label",8),e.EFF(12,"Last Name"),e.k0s(),e.nrm(13,"input",9),e.k0s(),e.j41(14,"div",5)(15,"label",10),e.EFF(16,"Username"),e.k0s(),e.nrm(17,"input",11),e.k0s(),e.j41(18,"div",5)(19,"label",12),e.EFF(20,"Email"),e.k0s(),e.nrm(21,"input",13),e.k0s(),e.j41(22,"div",5)(23,"label",14),e.EFF(24,"ID Number"),e.k0s(),e.nrm(25,"input",15),e.k0s(),e.j41(26,"div",5)(27,"label",16),e.EFF(28,"Date of Birth"),e.k0s(),e.nrm(29,"input",17),e.k0s()(),e.j41(30,"div",4)(31,"div",5)(32,"label",18),e.EFF(33,"Phone Number"),e.k0s(),e.nrm(34,"input",19),e.k0s(),e.j41(35,"div",5)(36,"label",20),e.EFF(37,"Gender"),e.k0s(),e.j41(38,"select",21)(39,"option",22),e.EFF(40,"Select gender"),e.k0s(),e.j41(41,"option",23),e.EFF(42,"Male"),e.k0s(),e.j41(43,"option",24),e.EFF(44,"Female"),e.k0s()()(),e.j41(45,"div",5)(46,"label",25),e.EFF(47,"User Type"),e.k0s(),e.j41(48,"select",26)(49,"option",22),e.EFF(50,"Select a user type"),e.k0s(),e.DNE(51,N,2,2,"option",27),e.k0s()(),e.j41(52,"div",28)(53,"div",29)(54,"label",30),e.EFF(55,"County"),e.k0s(),e.j41(56,"select",31)(57,"option",22),e.EFF(58,"Select county"),e.k0s(),e.DNE(59,_,2,2,"option",27),e.k0s()(),e.j41(60,"div",29)(61,"label",32),e.EFF(62,"Subcounty"),e.k0s(),e.j41(63,"select",33)(64,"option",22),e.EFF(65,"Select subcounty"),e.k0s(),e.DNE(66,U,2,2,"option",27),e.k0s()(),e.j41(67,"div",29)(68,"label",34),e.EFF(69,"Ward"),e.k0s(),e.j41(70,"select",35)(71,"option",22),e.EFF(72,"Select ward"),e.k0s(),e.DNE(73,T,2,2,"option",27),e.k0s()()(),e.j41(74,"div",5)(75,"label",36),e.EFF(76,"Password"),e.k0s(),e.nrm(77,"input",37),e.k0s(),e.j41(78,"div",5)(79,"label",38),e.EFF(80,"Confirm Password"),e.k0s(),e.nrm(81,"input",39),e.k0s()()(),e.j41(82,"div",40)(83,"button",41),e.EFF(84," Create User "),e.k0s()()()(),e.DNE(85,I,11,2,"ng-template",null,42,e.C5r),e.k0s()),2&r&&(e.R7$(1),e.Y8G("breadcrumbItems",i.breadCrumbItems),e.R7$(2),e.Y8G("formGroup",i.userForm),e.R7$(48),e.Y8G("ngForOf",i.userTypes),e.R7$(5),e.Y8G("disabled",i.isDisabled),e.R7$(3),e.Y8G("ngForOf",i.counties),e.R7$(7),e.Y8G("ngForOf",i.subCounties),e.R7$(7),e.Y8G("ngForOf",i.wards))},dependencies:[f.G,g.T,p.MD,p.Sq,F.x,s.X1,s.qT,s.xH,s.y7,s.me,s.wz,s.BC,s.cb,s.j4,s.JD],styles:['option[_ngcontent-%COMP%]{font-size:18px;background-color:#fff}option[_ngcontent-%COMP%]:before{content:">";font-size:20px;display:none;padding-right:10px;padding-left:5px;color:#fff}option[_ngcontent-%COMP%]:hover:before{display:inline}.form-select[_ngcontent-%COMP%]{height:40px!important}.form-select[_ngcontent-%COMP%]:focus{border:transparent!important;outline:none!important}']})}return o})()},{path:":id",component:(()=>{class o{constructor(t,r){this.route=t,this.usersService=r,this.activeTab="profile"}ngOnInit(){this.breadCrumbItems=[{label:"Users"},{label:"Profile",active:!0}],this.route.paramMap.subscribe(t=>{this.userId=t.get("id")}),this.fetchUserProfile()}selectTab(t){this.activeTab=t}fetchUserProfile(){this.usersService.getUserProfile(this.userId).subscribe(t=>{this.user=t},t=>{console.error("Error fetching users:",t)})}static#e=this.\u0275fac=function(r){return new(r||o)(e.rXU(u.nX),e.rXU(h.g))};static#t=this.\u0275cmp=e.VBU({type:o,selectors:[["app-user-profile"]],standalone:!0,features:[e.aNF],decls:31,vars:14,consts:[["title","Profile",3,"breadcrumbItems"],[2,"width","100%","display","flex","flex-direction","row","justify-content","space-between"],[2,"width","70%","display","flex","flex-direction","column","justify-content","space-between"],[2,"height","200px","background-color","white"],[2,"height","70%","border-bottom","1px solid #e9e9ef","width","100%","margin-right","auto","margin-left","auto","display","flex","padding-left","10px","padding-right","10px","justify-content","space-between"],[2,"display","flex","gap","20px","height","100%","align-items","center"],["src","https://datascience.cancer.gov/sites/default/files/2019-02/avatar.svg","alt","profile",2,"height","80%","border-radius","100%"],[1,"d-flex","flex-column"],[1,"lh-sm",2,"margin-bottom","0px"],[1,"lh-sm",2,"margin-bottom","20px"],[1,"d-flex","flex-row","align-items-center","gap-3"],[2,"height","40px","background-color","#fafafb","padding-left","20px","padding-right","20px","border-radius","5px","border","none"],[2,"height","30%","width","100%","display","flex","align-items","center","gap","10px","padding-left","10px","padding-right","10px"],[1,"nav-link",2,"margin","0px","cursor","pointer",3,"click"],[2,"height","390px","background-color","white"],[2,"height","10%","border-bottom","1px solid #e9e9ef","padding-left","10px","padding-right","10px","display","flex","align-items","center","margin-bottom","0px"],[2,"font-weight","bold","color","#fbab3d"],[2,"height","90%","padding-left","10px","padding-right","10px"],["style","display: flex; flex-direction: row",4,"ngIf"],[4,"ngIf"],[2,"width","28%","height","600px","background-color","white"],[2,"display","flex","flex-direction","row"],[2,"width","50%","height","100%","padding-top","10px","padding-bottom","10px"],[1,"d-flex","flex-column","gap-3"],[1,"d-flex","flex-row","align-items-center","gap-2"],[2,"margin-bottom","0px"]],template:function(r,i){1&r&&(e.nrm(0,"app-pagetitle",0),e.j41(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5),e.nrm(6,"img",6),e.j41(7,"div",7)(8,"p",8),e.EFF(9),e.k0s(),e.j41(10,"p",9),e.EFF(11),e.k0s(),e.j41(12,"p",8),e.EFF(13),e.k0s()()(),e.j41(14,"div",10)(15,"button",11),e.EFF(16," Message "),e.k0s()()(),e.j41(17,"div",12)(18,"p",13),e.bIt("click",function(){return i.selectTab("profile")}),e.EFF(19," Profile Information "),e.k0s(),e.j41(20,"p",13),e.bIt("click",function(){return i.selectTab("metadata")}),e.EFF(21," Other metadata "),e.k0s()()(),e.j41(22,"div",14)(23,"div",15)(24,"p",16),e.EFF(25),e.nI1(26,"titlecase"),e.k0s()(),e.j41(27,"div",17),e.DNE(28,$,64,10,"div",18)(29,D,3,0,"div",19),e.k0s()()(),e.nrm(30,"div",20),e.k0s()),2&r&&(e.Y8G("breadcrumbItems",i.breadCrumbItems),e.R7$(9),e.Lme(" ",i.user.firstName," ",i.user.lastName," "),e.R7$(2),e.JRh(i.user.email),e.R7$(2),e.SpI(" #id: ",i.user.username," "),e.R7$(5),e.AVh("active","profile"===i.activeTab),e.R7$(2),e.AVh("active","metadata"===i.activeTab),e.R7$(5),e.SpI(" ",e.bMT(26,12,i.activeTab)," Information "),e.R7$(3),e.Y8G("ngIf","profile"===i.activeTab),e.R7$(1),e.Y8G("ngIf","metadata"===i.activeTab))},dependencies:[f.G,g.T,p.MD,p.bT,p.PV],styles:[".nav-link.active[_ngcontent-%COMP%]{border-bottom:2px solid #fbb43c;color:#000}"]})}return o})()}];let O=(()=>{class o{static#e=this.\u0275fac=function(r){return new(r||o)};static#t=this.\u0275mod=e.$C({type:o});static#r=this.\u0275inj=e.G2t({imports:[u.iI.forChild(G),u.iI]})}return o})(),M=(()=>{class o{static#e=this.\u0275fac=function(r){return new(r||o)};static#t=this.\u0275mod=e.$C({type:o});static#r=this.\u0275inj=e.G2t({providers:[h.g],imports:[p.MD,O,s.YN,y]})}return o})()}}]);